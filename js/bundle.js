!function(){"use strict";class e extends Laya.View{constructor(){super(),this.autoDestroyAtClosed=!0,this.name=this.constructor.name,this._event={},this._aniArr=[],this.$updateArr=[]}onOpened(e){super.onOpened(),this.argObj=e,this.initData(),this.initUI(),this.initEvent()}initUI(){}initData(){}initEvent(){}addEvent(e,t){this._event[e]=t.bind(this),eventDispatcher.addEventListen(e,this,this._event[e])}removeEvent(e){eventDispatcher.removeEventListen(e,this,this._event[e])}removeAllEvent(){for(var e in this._event)this.removeEvent(e)}dispatchEvent(e,t){eventDispatcher.dispatchEvent(e,t)}playAni(e,t){e._aniID&&this._aniArr.push(e),e.play(0,t),e.$isPlaying=!0}stopAllAni(){for(var e=0;e<this._aniArr.length;e++){var t=this._aniArr[e];t.$isPlaying&&t.stop()}}resumeAllAni(){for(var e=0;e<this._aniArr.length;e++){var t=this._aniArr[e];t.$isPlaying&&t.play(0,t.loop)}}removeTimer(){if(this.$updateArr)for(var e=0;e<this.$updateArr.length;e++)updateManager.clear(this.$updateArr[e])}doClose(){uiManager.closeUI(this.url,this.parent)}onClosed(){this.removeTimer(),this.stopAllAni(),this.removeAllEvent()}}class t extends Laya.AnimatorStateScript{constructor(){super(),this._onAniComplete=null,this._onAniStart=null}onStateEnter(){this._onAniStart&&this._onAniStart()}onStateUpdate(){}onStateExit(){this._onAniComplete&&this._onAniComplete()}setComplete(e){this._onAniComplete=e}setStart(e){this._onAniStart=e}}class i extends Laya.Script3D{constructor(){super()}onAwake(){this.owner.script=this,this.initData()}initData(){this.herobase=this.owner.parent,this.baseTransform=this.herobase.transform,this.runSpeed=1.3,this.climbSpeed=.4,this.swimSpeed=.75,this.flySpeed=.75,this.atk=.3,this.owner==G.BattleUI.heroBase._children[0]?this.aceBet=1.2:this.aceBet=1,this.moveCD=0,this.state=G.ROLE_STATE.RUN,this._ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),this.temp1Vec3=new Laya.Vector3(0,0,1),this.tempVec3=new Laya.Vector3(0,0,0),this.animationConfig={Idle:"res/model/Conventional/Assets/animator/Idle.lani",ClimbingUp:"res/model/Conventional/Assets/animator/ClimbingUp.lani",Flying:"res/model/Conventional/Assets/animator/Flying.lani",punch:"res/model/Conventional/Assets/animator/punch.lani",Running:"res/model/Conventional/Assets/animator/Running.lani",Swimming:"res/model/Conventional/Assets/animator/Swimming.lani",ClimbHang:"res/model/Conventional/Assets/animator/ClimbHang.lani",Jump:"res/model/Conventional/Assets/animator/Jump.lani",Victory:"res/model/Conventional/Assets/animator/victory.lani",Fail:"res/model/Conventional/Assets/animator/fail.lani"},this.wingAni={Idle:"res/model/Conventional/Assets/animator/Eagle_Wings-Wings_idle.lani",Fly:"res/model/Conventional/Assets/animator/Eagle_Wings-Wings_climb.lani"},this.tailAni={Idle:"res/model/Conventional/Assets/animator/Crocodile_Tail-tail_run.lani",Swim:"res/model/Conventional/Assets/animator/Crocodile_Tail-tail_box.lani"},this.bodyParts=[],this.openChangeView=!1}loadRole(e){this.curModel=this.owner.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(.1,.1,.1))),this.curModel.meshRenderer.material=G.nullMat,ModelCfg.getIns().setLocalScale(this.curModel,.7),this.newPart=e;let t=[30006,30005,30007,30011];for(let e=0;e<this.newPart.length;e++){let i=D.AnimalParts[this.newPart[e]];"head"==i.type2?t[2]=i.modelId:"hand"==i.type2?t[1]=i.modelId:"leg"==i.type2&&(t[3]=i.modelId)}for(let e=0;e<t.length;e++)ModelCfg.getIns().getModelById(t[e],function(i){if(this.curModel.addChild(i),30005==t[e]?this.hand=i:30007==t[e]?this.head=i:30011==t[e]&&(this.leg=i),30010==t[e]){this.Spider=i;for(let e=0;e<i._children[0]._children.length;e++){let t=i._children[0]._children[e],o=t.getComponent(Laya.Animator);(a=new Laya.AnimatorControllerLayer("Base Layer")).defaultWeight=1,(s=0)&&(a.blendingMode=s),o.addControllerLayer(a);for(let e in this.animationConfig)this.loadAnimation(o,e,this.animationConfig[e]);this.bodyParts.push(t)}}else{30006==t[e]&&(this.bodyModel=i),30001==t[e]&&G.contains(this.newPart,11)&&ModelCfg.getIns().setMaterialPic(i,"res/tex/Rabbit_Legs_Albedo.jpg");let o=i.getChildAt(0).getComponent(Laya.Animator);var a,s;(a=new Laya.AnimatorControllerLayer("Base Layer")).defaultWeight=1,(s=0)&&(a.blendingMode=s),o.addControllerLayer(a);for(let e in this.animationConfig)this.loadAnimation(o,e,this.animationConfig[e]);this.bodyParts.push(i.getChildAt(0))}for(var o in D.AnimalParts)D.AnimalParts[o].modelId==t[e]&&(this[D.AnimalParts[o].type2]=i,console.log(D.AnimalParts[o].type2))}.bind(this));for(let e=0;e<this.newPart.length;e++){let t=D.AnimalParts[this.newPart[e]];t.bone&&ModelCfg.getIns().getModelById(t.modelId,function(e){if(utils.getChildDeep(this.bodyModel,t.bone).addChild(e),this[t.type2]=e,t.type2&&"bei"!=t.type2){let a=e.getChildAt(0).getComponent(Laya.Animator);var i=new Laya.AnimatorControllerLayer("Base Layer");i.defaultWeight=1;a.addControllerLayer(i);for(let e in this[t.type2+"Ani"])this.loadAnimation(a,e,this[t.type2+"Ani"][e])}}.bind(this))}}changePart(e){let t=D.AnimalParts[e];if(this[t.type2]){G.remove(this.bodyParts,this[t.type2].getChildAt(0));for(var i=0;i<this.bodyParts.length;i++)this.bodyParts[i].name.indexOf(this[t.type2].name)>-1&&(G.remove(this.bodyParts,this.bodyParts[i]),i--);this.Spider==this[t.type2]&&(this.Spider=null),this[t.type2].destroy()}t.bone?ModelCfg.getIns().getModelById(t.modelId,function(e){if(utils.getChildDeep(this.bodyModel,t.bone).addChild(e),t.type2&&"bei"!=t.type2){this[t.type2]=e;let a=e.getChildAt(0).getComponent(Laya.Animator);var i=new Laya.AnimatorControllerLayer("Base Layer");i.defaultWeight=1;a.addControllerLayer(i);for(let e in this[t.type2+"Ani"])this.loadAnimation(a,e,this[t.type2+"Ani"][e])}this.curAnim;this.curAnim=null,this.playAni(this.curAnim)}.bind(this)):ModelCfg.getIns().getModelById(t.modelId,function(i){if(this.curModel.addChild(i),30010==t.modelId){this.Spider=i;for(let e=0;e<i._children[0]._children.length;e++){let t=i._children[0]._children[e],o=t.getComponent(Laya.Animator);(a=new Laya.AnimatorControllerLayer("Base Layer")).defaultWeight=1,(s=0)&&(a.blendingMode=s),o.addControllerLayer(a);for(let e in this.animationConfig)this.loadAnimation(o,e,this.animationConfig[e]);this.bodyParts.push(t)}}else{30001==t.modelId&&11==e&&ModelCfg.getIns().setMaterialPic(i,"res/tex/Rabbit_Legs_Albedo.jpg");let o=i.getChildAt(0).getComponent(Laya.Animator);var a,s;(a=new Laya.AnimatorControllerLayer("Base Layer")).defaultWeight=1,(s=0)&&(a.blendingMode=s),o.addControllerLayer(a);for(let e in this.animationConfig)this.loadAnimation(o,e,this.animationConfig[e]);this.bodyParts.push(i.getChildAt(0))}this[t.type2]=i;this.curAnim;this.curAnim=null,this.playAni(this.curAnim)}.bind(this))}setMatCap(e,t){this.curMatPath=t,Laya.Texture2D.load(t,Laya.Handler.create(this,function(t){this.queryMat(e,t)}))}queryMat(e,t){if(e.meshRenderer?e.meshRenderer.material.matCapTexture=t:e.skinnedMeshRenderer&&(e.skinnedMeshRenderer.material.matCapTexture=t),e._children.length>0)for(let i=0;i<e._children.length;i++)this.queryMat(e._children[i],t)}emoji(e){if(this.emojieffect&&this.emojieffect._destroyed&&this.emojieffect.destroy(),"cool"==e)ModelCfg.getIns().getModelById(40009,function(e){this.curModel.addChild(e),ModelCfg.getIns().setLocalPosition(e,0,1.4,0),this.emojieffect=e,Laya.timer.once(2e3,this,function(){e._destroyed||e.destroy()})}.bind(this));else if("fail"==e){let e=Math.random()>.5?40008:40010;ModelCfg.getIns().getModelById(e,function(e){this.curModel.addChild(e),ModelCfg.getIns().setLocalPosition(e,0,1.4,0),this.emojieffect=e,Laya.timer.once(2e3,this,function(){e._destroyed||e.destroy()})}.bind(this))}else"victory"==e&&ModelCfg.getIns().getModelById(40011,function(e){this.curModel.addChild(e),ModelCfg.getIns().setLocalPosition(e,0,1.4,0)}.bind(this))}checkType(e){if("fly"==e){if(G.contains(this.newPart,3))return this.flySpeed=2,!0}else if("punch"==e){if(G.contains(this.newPart,5)||G.contains(this.newPart,7)||G.contains(this.newPart,10))return this.atk=1.5,!0}else if("run"==e){if(G.contains(this.newPart,8)||G.contains(this.newPart,11))return this.runSpeed=1.8,!0}else if("swim"==e){if(G.contains(this.newPart,1)||G.contains(this.newPart,4)||G.contains(this.newPart,2))return this.swimSpeed=1.75,!0}else if("climb"==e&&(G.contains(this.newPart,9)||G.contains(this.newPart,12)||G.contains(this.newPart,6)))return this.climbSpeed=1.2,!0;return!1}loadAnimation(e,t,i,a){Laya.loader.create([i],new Laya.Handler(this,function(s){let o=Laya.Loader.getRes(i),n=e._controllerLayers[0];var l=new Laya.AnimatorState;l.name=t,l.clip=o,n.addState(l),a&&a()}))}moveDir(e){this.dirTime=.2,e?this.curModel.transform.localRotationEulerY<20&&(this.curModel.transform.localRotationEulerY+=1):this.curModel.transform.localRotationEulerY>-20&&(this.curModel.transform.localRotationEulerY-=1)}setRolePos(e){if(this.owner.lastRoad){this.owner.transform.localPositionX,this.owner.lastRoad.script.getBezierPoint(this.herobase.transform.position.z)}}move(e){if(this.moveCD>0&&(this.moveCD-=e),this.state==G.ROLE_STATE.RUN){this.playAni("Running",null,!0,1,.1);var t=e*this.runSpeed*this.aceBet;if(this.baseTransform.localPositionZ+=t,this.owner.lastRoad){let e=this.owner.lastRoad.script.getBezierPoint(this.herobase.transform.position.z);e&&(this.curModel.transform.localPositionX=e[0],this.curModel.transform.localPositionY=e[1]);let i=this.owner.lastRoad.script.checkLimit(this.owner.transform.position.z);if(1==i.length&&(this.owner.transform.localPositionX+=.1*(i[0]-this.owner.transform.localPositionX),this.owner.lastRoad.script.roadType==G.ROAD_TYPE.BELT&&(this.checkType("fly"),this.wing&&(this.speedLine?this.speedLine.active=!0:ModelCfg.getIns().getModelById(40003,function(e){this.curModel.addChild(e),this.speedLine=e}.bind(this)),ModelCfg.getIns().playAnim(this.wing,"Fly"),this.playAni("Flying",null,!0,1,.1)),this.state=G.ROLE_STATE.FLY)),this.owner.lastRoad._children[0].name.indexOf("pool")>-1)this.state=G.ROLE_STATE.SWIM,this.playAni("Jump",function(){this.owner==G.BattleUI.hero&&audioManager.playSound(14,null,!0),this.checkType("swim")?this.playAni("Swimming",null,!1,1.5,.1):this.playAni("Swimming",null,!1,.8,.1),G.BattleUI.createEffectWater(this.owner.transform.position.x,this.owner.transform.position.y,this.owner.transform.position.z),this.tail&&ModelCfg.getIns().playAnim(this.tail,"Swim")}.bind(this),!1,1,.1);else{let e=this.curModel.transform.position;this.tempVec3.x=e.x,this.tempVec3.y=e.y+.5,this.tempVec3.z=e.z,this.temp1Vec3.x=e.x,this.temp1Vec3.y=e.y+.5,this.temp1Vec3.z=e.z+2*t;let i=G.BattleUI.checkCollider(this.tempVec3,this.temp1Vec3,Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER1);if(i&&(this.checkType("climb")?this.playAni("ClimbingUp",null,!0,1.6,.1):this.playAni("ClimbingUp",null,!0,.8,.1),this.state=G.ROLE_STATE.CLIMB),this.owner.lastRoad&&this.owner==G.BattleUI.hero){this.owner.lastRoad.script.checkDNA(e)&&uiManager.openUI("gameView/ChangeView.scene",null,{curSkin:this.newPart,callback:e=>{for(let t=0;t<e.length;t++)this.newPart.push(e[t]),this.changePart(e[t])}})}if((i=G.BattleUI.checkCollider(this.tempVec3,this.temp1Vec3,Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER2))&&(this.owner==G.BattleUI.hero&&audioManager.playSound(7,null,!0),this.punchStone=i.collider.owner.parent,this.state=G.ROLE_STATE.PUNCH,this.checkType("punch")?this.playAni("punch",null,!0,2.2,.1):this.playAni("punch",null,!0,1.7,.1),this.punchEffect?this.punchEffect.active=!0:ModelCfg.getIns().getModelById(40002,function(e){this.curModel.addChild(e),this.punchEffect=e,ModelCfg.getIns().setLocalPosition(e,0,.5,.4)}.bind(this))),this.tempVec3.x=e.x,this.tempVec3.y=e.y+.5,this.tempVec3.z=e.z,this.temp1Vec3.x=e.x,this.temp1Vec3.y=e.y-.5,this.temp1Vec3.z=e.z,i=G.BattleUI.checkCollider(this.tempVec3,this.temp1Vec3,Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER3))return this.playAni("Idle",null,!0,1),this.state=null,ModelCfg.getIns().getModelById(40001,function(e){this.curModel.addChild(e),ModelCfg.getIns().setLocalPosition(e,0,0,2)}.bind(this)),!0}}}else if(this.state==G.ROLE_STATE.CLIMB){let t=e*this.climbSpeed*this.aceBet;this.baseTransform.localPositionY+=t;let i=this.curModel.transform.position;if(this.tempVec3.x=i.x,this.tempVec3.y=i.y+.8,this.tempVec3.z=i.z,this.temp1Vec3.x=i.x,this.temp1Vec3.y=i.y+.8,this.temp1Vec3.z=i.z+.5,G.BattleUI.checkCollider(this.tempVec3,this.temp1Vec3,Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER1)){let t=this.curModel.transform.position;this.tempVec3.x=t.x-.2,this.tempVec3.y=t.y,this.tempVec3.z=t.z,this.temp1Vec3.x=t.x-.2,this.temp1Vec3.y=t.y,this.temp1Vec3.z=t.z+.5;let i=G.BattleUI.checkCollider(this.tempVec3,this.temp1Vec3,Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER1);i||(this.owner.transform.localPositionX+=2*e),this.tempVec3.x=t.x+.2,this.tempVec3.y=t.y,this.tempVec3.z=t.z,this.temp1Vec3.x=t.x+.2,this.temp1Vec3.y=t.y,this.temp1Vec3.z=t.z+.5,(i=G.BattleUI.checkCollider(this.tempVec3,this.temp1Vec3,Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER1))||(this.owner.transform.localPositionX-=2*e)}else this.state=null,this.Spider&&(utils.getChildDeep(this.Spider,"Spider_Arms2").active=!1,utils.getChildDeep(this.Spider,"Spider_Arms3").active=!1),this.playAni("ClimbHang",function(){this.Spider&&(utils.getChildDeep(this.Spider,"Spider_Arms2").active=!0,utils.getChildDeep(this.Spider,"Spider_Arms3").active=!0),this.moveCD=.5,this.baseTransform.localPositionY+=.8,this.state=G.ROLE_STATE.RUN,this.playAni("Running",null,!0)}.bind(this),!1,2,.1)}else if(this.state==G.ROLE_STATE.SWIM){if("Running"==this.curAnim)t=e*this.runSpeed*this.aceBet;else t=e*this.swimSpeed*this.aceBet;if(this.baseTransform.localPositionZ+=t,this.owner.lastRoad)if(-1==this.owner.lastRoad._children[0].name.indexOf("pool"))this.state=G.ROLE_STATE.RUN;else if("Swimming"==this.curAnim){let e=this.owner.lastRoad.script.getBezierPoint(this.herobase.transform.position.z);e&&(this.curModel.transform.localPositionX=e[0],this.curModel.transform.localPositionY=e[1]-.5);let t=this.owner.lastRoad.script.checkLimit(this.owner.transform.position.z);1==t.length&&(this.owner.transform.localPositionX+=.1*(t[0]-this.owner.transform.localPositionX)),G.BattleUI.roadmodel.script.getCurRoad(this.herobase.transform.position.z+.7,this.curModel.transform.position.x)!=this.owner.lastRoad&&"Running"!=this.curAnim&&(this.playAni("Running",null,!0,1,.1),this.curModel.transform.localPositionY+=.5,this.tail&&ModelCfg.getIns().playAnim(this.tail,"Idle"),this.owner==G.BattleUI.hero&&audioManager.stopSound(14))}}else if(this.state==G.ROLE_STATE.FLY){if(this.checkType("run"))t=e*this.flySpeed*this.aceBet*(this.runSpeed/1.5);else t=e*this.flySpeed*this.aceBet;if(this.baseTransform.localPositionZ+=t,this.owner.lastRoad){let e=this.owner.lastRoad.script.getBezierPoint(this.herobase.transform.position.z);e&&(this.curModel.transform.localPositionX=e[0],this.curModel.transform.localPositionY=e[1]);let t=this.owner.lastRoad.script.checkLimit(this.owner.transform.position.z);1==t.length?this.owner.transform.localPositionX+=.1*(t[0]-this.owner.transform.localPositionX):(this.speedLine&&(this.speedLine.active=!1),this.state=G.ROLE_STATE.RUN,this.wing&&ModelCfg.getIns().playAnim(this.wing,"Idle"))}}else this.state==G.ROLE_STATE.PUNCH&&(this.punchStone.HP-=e*this.atk*this.aceBet,this.punchStone.HP<=0&&(this.owner==G.BattleUI.hero&&audioManager.stopSound(7),this.punchEffect.active=!1,ModelCfg.getIns().playAnim(this.punchStone,"break",null,function(){Laya.timer.callLater(this,function(){this.punchStone.destroy()})}.bind(this)),this.state=G.ROLE_STATE.RUN))}playAni(e,i,a,s,o){if(e!=this.curAnim){"Running"==e&&this.checkType("run")?this.runEffect?this.runEffect.active=!0:ModelCfg.getIns().getModelById(40004,function(e){this.curModel.addChild(e),this.runEffect=e}.bind(this)):("Victory"==e?this.emoji("victory"):"Fail"==e&&this.emoji("fail"),this.runEffect&&(this.runEffect.active=!1));for(let l=0;l<this.bodyParts.length;l++){let r=this.bodyParts[l].getComponent(Laya.Animator);if(r){o?r.crossFade(e,o,0,0):r.play(e,0,0);var n=r._controllerLayers[0]._statesMap[e];n.script||(n.addScript(t),n.script=n._scripts[0],n.script.loop=a||n._clip.islooping,n.script.animator=r,n.script.animName=e),s||(s=1),n.speed=s,n.script.setComplete(i),this.curAnim=r.curAnim=e}else console.error(this.curModel,"动作控制器未加载！")}}}stopAnim(e){let t=this.curModel.getComponent(Laya.Animator);t&&(e||(e=this.curAnim),e&&(t._controllerLayers[0]._statesMap[e].speed=0))}onDestroy(){}}class a extends Laya.Script3D{constructor(){super()}onAwake(){this.owner.script=this;for(var e=0;e<this.owner._children.length;e++){let t=this.owner._children[e];t.name.indexOf("climbWall")>-1&&(this.climbWall=t)}this.hitPoint=new Laya.Vector3,this.roadArr=[],this.obsArr=[],this.wall=[],this.DNA=[]}onUpdate(){if(this.beltModels)for(let e=0;e<this.beltModels.length;e++){let t=this.beltModels[e];t._children[0].meshRenderer.material.tilingOffsetW+=.04,t._children[0].meshRenderer.material.tilingOffsetW>1&&(t._children[0].meshRenderer.material.tilingOffsetW-=1)}}setNextRoadInfo(e){if(this.p0=utils.getChildDeep(this.owner,"pointStart").transform.localPosition,this.startZ=this.p0.z,this.bezierLength=utils.getChildDeep(this.owner,"pointEnd").transform.localPositionZ-this.startZ,this.p1=utils.getChildDeep(this.owner,"pointMiddle").transform.localPosition,this.p2=utils.getChildDeep(this.owner,"pointEnd").transform.localPosition,this.climbWall&&e){let t=e.transform.position,i=utils.getChildDeep(this.owner,"pointEnd").transform.position;this.p3=new Laya.Vector3(t.x,i.y,i.z),this.roadLength=t.z-this.owner.transform.position.z}else e?(this.p3=e.transform.position,this.roadLength=this.p3.z-this.owner.transform.position.z):(this.p3=utils.getChildDeep(this.owner,"pointEnd").transform.position,this.roadLength=this.p3.z-this.owner.transform.position.z);this.p4=this.owner.transform.position,this.p5=new Laya.Vector3(this.p3.x-this.p4.x,this.p3.y-this.p4.y,this.p2.z);let t=new Laya.Vector3(this.p0.x,this.p0.y,this.p0.z+.1*this.bezierLength),i=new Laya.Vector3(this.p5.x,this.p5.y,this.p5.z-.1*this.bezierLength);this.bezierPoint=[this.p0,t,this.p1,i,this.p5],this.resetRoad()}resetRoad(){let e=this.owner._children.length;for(var t=0;t<e;t++){let e=this.owner._children[t];if(!(e.name.indexOf("point")>-1))if(e.name.indexOf("stone")>-1){let t=e.name.split("_")[1];e.active=!1,ModelCfg.getIns().getModelById(t,function(i){10020==t?i.HP=2:(t=10021)&&(i.HP=3),this.wall.push(i),i._children[0].getComponent(Laya.PhysicsCollider).collisionGroup=Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER2,this.owner.addChild(i);let a=this.getBezierPoint(e.transform.position.z);ModelCfg.getIns().setLocalPosition(i,e.transform.localPositionX+a[0],e.transform.localPositionY+a[1],e.transform.localPositionZ)}.bind(this))}else if(e.name.indexOf("10022")>-1){let t=e.name.split("_")[1];e.active=!1,ModelCfg.getIns().getModelById(t,function(t){this.wall.push(t),t._children[0].getComponent(Laya.PhysicsCollider).collisionGroup=Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER3,this.owner.addChild(t);let i=this.getBezierPoint(e.transform.position.z);ModelCfg.getIns().setLocalPosition(t,e.transform.localPositionX+i[0],e.transform.localPositionY+i[1],e.transform.localPositionZ),G.BattleUI.totalLength=t.transform.position.z}.bind(this))}else if(e.name.indexOf("climbWall")>-1){let t=e.name.split("_")[1];e.active=!1,ModelCfg.getIns().getModelById(t,function(t){this.wall.push(t),t._children[0].getComponent(Laya.PhysicsCollider).collisionGroup=Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER1,this.owner.addChild(t);let i=this.getBezierPoint(e.transform.position.z);ModelCfg.getIns().setLocalPosition(t,e.transform.localPositionX+i[0],e.transform.localPositionY+i[1],e.transform.localPositionZ)}.bind(this))}else if(e.name.indexOf("DNA")>-1)e.active=!1,ModelCfg.getIns().getModelById(10025,function(t){ModelCfg.getIns().getModelById(40013,function(e){t.addChild(e)}.bind(this)),this.DNA.push(t),t._children[0].getComponent(Laya.PhysicsCollider).collisionGroup=Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER4,this.owner.addChild(t);let i=this.getBezierPoint(e.transform.position.z);ModelCfg.getIns().setLocalPosition(t,e.transform.localPositionX+i[0],e.transform.localPositionY+i[1],e.transform.localPositionZ)}.bind(this));else{let t=e.name.split("_")[1];e.active=!1,ModelCfg.getIns().getModelById(t,function(t){this.owner.addChild(t),this.limitL=utils.getChildDeep(t,"pointLimitL").transform.localPositionX,this.limitR=utils.getChildDeep(t,"pointLimitR").transform.localPositionX,this._roadModel=t,e.name.split("_")[0].indexOf("belt")>-1?(this.beltModels=[],this.roadType=G.ROAD_TYPE.BELT):e.name.split("_")[0].indexOf("pool")?this.roadType=G.ROAD_TYPE.POOL:this.roadType=G.ROAD_TYPE.ROAD;for(let e=0;e<t._children[0]._children.length;e++){let i=t._children[0]._children[e];this.resetVex(i,i.transform.localPosition.z),this.beltModels&&(i.name.indexOf("Start")>-1||i.name.indexOf("Middle")>-1||i.name.indexOf("End")>-1)&&this.beltModels.push(i)}}.bind(this))}}}resetVex(e,t){if(e.meshRenderer){let i=e.meshRenderer.material;i.customValue1=t,i.customValue2=this.bezierLength,i.customVector1=this.bezierPoint[0],i.customVector2=this.bezierPoint[2],i.customVector3=this.bezierPoint[4],e.meshRenderer.isAlwayShow=!0}if(e._children)for(var i=0;i<e._children.length;i++)this.resetVex(e._children[i],t)}checkDNA(e){for(var t=0;t<this.DNA.length;t++){let i=this.DNA[t],a=i.transform.position;if(i.active&&Laya.Vector3.distance(a,e)<.5)return i.active=!1,i}}checkWall(e){for(var t=0;t<this.wall.length;t++){let i=this.wall[t],a=this.rayCheck(e,i);if(a)return a}}checkCollider(e){for(var t=0;t<this._roadModel._children[0]._children.length;t++){let i=this._roadModel._children[0]._children[t],a=this.rayCheck(e,i);if(a)return a}}rayCheck(e,t){if(this.hitPoint.x=0,this.hitPoint.y=0,this.hitPoint.z=0,t.meshRenderer&&-1!=Laya.CollisionUtils.intersectsRayAndBoxRP(e,t.meshRenderer._bounds._boundBox,this.hitPoint))return this.hitPoint;if(t._children)for(var i=0;i<t._children.length;i++)return this.rayCheck(e,t._children[i]);return!1}checkLimit(e){return e-this.owner.transform.position.z>=this.startZ&&e-this.owner.transform.position.z<=this.p2.z?this._roadModel.name.indexOf("10005")>-1||this._roadModel.name.indexOf("10004")>-1||this._roadModel.name.indexOf("10011")>-1||this._roadModel.name.indexOf("10012")>-1?[(this.limitL+this.limitR)/2]:[this.limitL,this.limitR]:[1.2,-1.2]}getBezierPoint(e){let t=(e-this.owner.transform.position.z-this.startZ)/this.bezierLength;return this.Bezier(t,this.bezierPoint)}Bezier(e,t){e>1?e=1:e<0&&(e=0);let i=[0,0,0];for(var a=0;a<t.length;a++){let s=this.BaseBezier(e,a,t.length-1);i[0]+=t[a].x*s,i[1]+=t[a].y*s,i[2]+=t[a].z*s}return i}BaseBezier(e,t,i){return this.Fa(i)*Math.pow(e,t)*Math.pow(1-e,i-t)/(this.Fa(t)*this.Fa(i-t))}Fa(e){let t=1;for(var i=e;i>1;i--)t*=i;return t}onDestroy(){}}class s extends Laya.Script3D{constructor(){super()}onAwake(){this.owner.script=this,this.models=this.owner._children;let e=null;for(var t=0;t<this.models.length;t++){let s=this.models[t],o=s.name.split("_");e=null;for(var i=0;i<this.models.length;i++)if(this.models[i].name.indexOf("road_"+(parseInt(o[1])+1))>-1){e=this.models[i];break}s.addComponent(a),s.script.setNextRoadInfo(e)}}getCurRoad(e,t){let i=[];for(var a=0;a<this.models.length;a++){let t=this.models[a];t.transform.position.z<e&&t.transform.position.z+t.script.roadLength>e&&i.push(t)}if(1==i.length)return i[0];if(2==i.length){let s=i[0].script.getBezierPoint(e);if(t>i[0].transform.position.x+s[0]){for(a=0;a<i.length;a++)if(i[a].name.indexOf("_l")>-1)return i[a]}else for(a=0;a<i.length;a++)if(i[a].name.indexOf("_r")>-1)return i[a]}}onDestroy(){}}class o extends e{constructor(){super()}initData(){G.BattleUI=this,this.roleArr=[],this._ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),this._clickPoint=new Laya.Point,this._hitRes=new Laya.HitResult,this.roleLoading=3,this.tempVec3=new Laya.Vector3,this.temp1Vec3=new Laya.Vector3(0,0,1),this.totalLength=0,G.nullMat||(G.nullMat=new Laya.BlinnPhongMaterial,Laya.Texture2D.load("res/tex/null.png",Laya.Handler.create(null,function(e){G.nullMat.albedoTexture=e,G.nullMat.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT}.bind(this))))}initUI(){this.createScene(),this.lab_level.text="Level "+dataManager.getPlayerData("roundNum"),this.ani1.play(0,!0),window.uleeSDK&&(console.log("展示横幅 BattleUI"),uleeSDK.showAD(!0))}initEvent(){this.on(Laya.Event.MOUSE_DOWN,this,this.onDown),this.on(Laya.Event.MOUSE_MOVE,this,this.onMove),this.on(Laya.Event.MOUSE_UP,this,this.onUp),this.on(Laya.Event.MOUSE_OUT,this,this.onUp)}loop(){let e=G.FRAME_INTERVAL;if(!G.ChangeUI){for(var t=0;t<this.roleArr.length;t++){let i=this.roleArr[t];if(i.script.move(e)){this.winner?i.script.playAni("Fail"):(i.script.playAni("Victory"),this.winner=i),i==this.hero&&(audioManager.stopMusic(),audioManager.playSound(16),Laya.timer.once(2e3,this,function(){this.endGame(),window.uleeSDK&&uleeSDK.showAD(!1),window.uleeSDK&&"tt"==uleeSDK.pf?uiManager.openUI("gameView/ShareView.scene",null,{callback:()=>{uleeSDK&&uleeSDK.gameConfig&&1==uleeSDK.gameConfig.touchMistake&&1==uleeSDK.gameConfig.ulee_switch?(console.log("有宝箱"),uiManager.openUI("gameView/BoxView.scene",null,{callback:()=>{uiManager.openUI("gameView/GameOverView.scene")}})):(console.log("没宝箱"),uiManager.openUI("gameView/GameOverView.scene"))}}):window.uleeSDK&&uleeSDK.gameConfig&&1==uleeSDK.gameConfig.touchMistake&&1==uleeSDK.gameConfig.ulee_switch?(console.log("有宝箱"),uiManager.openUI("gameView/BoxView.scene",null,{callback:()=>{uiManager.openUI("gameView/GameOverView.scene")}})):(console.log("没宝箱"),uiManager.openUI("gameView/GameOverView.scene")),this.doClose()}));break}if(this._ray.origin.x=i.transform.position.x,this._ray.origin.y=i.transform.position.y+.5,this._ray.origin.z=i.transform.position.z,this._ray.direction.x=0,this._ray.direction.y=-1,this._ray.direction.z=0,!i.lastRoad||i.transform.position.z>i.lastRoad.transform.position.z+i.lastRoad.script.roadLength){let e=this.roadmodel.script.getCurRoad(i.transform.position.z,i.script.curModel.transform.position.x);if(e){i.lastRoad=e,i.parent.transform.localPositionY=e.transform.localPositionY,i.parent.transform.localPositionX=e.transform.localPositionX;let t=e.script.getBezierPoint(this.heroBase.transform.position.z);t&&(i.script.curModel.transform.localPositionX=t[0],i.script.curModel.transform.localPositionY=t[1])}else i.lastRoad=null}}this.winner||(this.roleArr.sort(function(e,t){return t.transform.position.z-e.transform.position.z}),this.first?this.first!=this.roleArr[0]&&(this.first=this.roleArr[0],this.roleArr[0].script.emoji("cool"),this.roleArr[1].script.emoji("fail"),this.roleArr[2].script.emoji("fail")):(this.first=this.roleArr[0],this.roleArr[0].script.emoji("cool"),this.roleArr[1].script.emoji("fail"),this.roleArr[2].script.emoji("fail"))),this.panel_pro.width=500*this.hero.transform.position.z/this.totalLength,Laya.Vector3.lerp(this.camera.transform.position,this.hero.script.curModel.transform.position,.04,this.tempVec3),this.tempVec3.x-=.06,this.tempVec3.y+=.1,this.tempVec3.z-=.1,this.camera.transform.position=this.tempVec3,this.water&&(this.water.meshRenderer.material.tilingOffsetW+=.03,this.water.meshRenderer.material.tilingOffsetW>1&&(this.water.meshRenderer.material.tilingOffsetW-=1))}}createScene(){this.newScene=this.box_3dscene.addChild(new Laya.Scene3D),this.newScene.ambientColor=new Laya.Vector3(.7,.7,.7);var e=new Laya.DirectionLight;this.newScene.addChild(e),e.color=new Laya.Vector3(1,1,1),e.intensity=.38,e.transform.position=new Laya.Vector3(1.41,10.65,-17.23),e.transform.rotationEuler=new Laya.Vector3(-90,60,0),this.newScene.enableFog=!0,this.newScene.fogColor=new Vector3(6/255,183/255,239/255),this.newScene.fogStart=7,this.newScene.fogRange=15,this.camera=cameraUtils.createCamera(new Laya.Vector3(-1.5,2.5,-3),new Laya.Vector3(0,0,0)),this.camera.transform.lookAt(new Laya.Vector3(0,0,0),cameraUtils.upPos),this.camera.fieldOfView=75,this.newScene.addChild(this.camera),this.initScene(),this.createRole(),this.addRobot(1),this.addRobot(-1),Laya.timer.once(1500,this,this.startGame)}initScene(){ModelCfg.getIns().getModelById(D.RoundConfig[dataManager.getPlayerData("level")].modelId,function(e){this.newScene.addChild(e),e.addComponent(s),this.roadmodel=e,this.loadRoadComplete=!0,0==this.roleLoading&&this.loadRoadComplete&&this.startGame()}.bind(this)),ModelCfg.getIns().getModelById(10023+utils.random(0,1),function(e){this.newScene.addChild(e),this.water=utils.getChildDeep(e,"Water_0")}.bind(this))}createRole(){this.heroBase=this.newScene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(.1,.1,.1))),this.heroBase.meshRenderer.material=G.nullMat;var e=this.heroBase.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(.1,.1,.1)));e.meshRenderer.material=G.nullMat,e.addComponent(i),e.script.loadRole(this.argObj.parts),this.hero=e,this.roleArr.push(this.hero)}addRobot(e){let t=this.newScene.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(.1,.1,.1)));t.meshRenderer.material=G.nullMat;var a=t.addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(.1,.1,.1)));a.meshRenderer.material=G.nullMat,ModelCfg.getIns().setLocalPosition(a,.75*e,0,0),a.addComponent(i);let s=[],o=[1,4,3,2,5,7,10],n=[6,8,9,11,12];s.push(o[utils.random(0,o.length-1)]),s.push(n[utils.random(0,n.length-1)]),a.script.loadRole(s),this.roleArr.push(a)}startGame(){for(var e=0;e<this.roleArr.length;e++){this.roleArr[e].script.playAni("Idle")}Laya.timer.once(500,this,function(){this.ani2.play(0,!1),this.ani2.on(Laya.Event.COMPLETE,this,function(){this.loopKey=updateManager.frameLoop(1,this,this.loop)}),this.img_loading.visible=!1})}stopGame(){this.loopKey&&(updateManager.clear(this.loopKey,this),this.loopKey=null)}endGame(){this.stopGame()}createEffectWater(e,t,i){ModelCfg.getIns().getModelById(40005,function(a){this.newScene.addChild(a),ModelCfg.getIns().setLocalPosition(a,e,t,i),Laya.timer.once(1e3,this,function(){a.destroy()})}.bind(this))}checkCollider(e,t,i){if(this.newScene.physicsSimulation.raycastFromTo(e,t,this._hitRes,i,i),this._hitRes.succeeded)return this._hitRes}onDown(e){this.loopKey&&(this.isTouch=!0,this.lastX=e.stageX)}onUp(e){this.isTouch=!1}onMove(e){if(this.isTouch&&this.loopKey){if(this.hero.lastRoad&&this.hero.script.state!=G.ROLE_STATE.PUNCH&&this.hero.script.moveCD<=0&&"ClimbHang"!=this.hero.script.curAnim&&"Jump"!=this.hero.script.curAnim){let t=this.hero.lastRoad.script.checkLimit(this.hero.transform.position.z),i=720/Laya.stage.width*(e.stageX-this.lastX)/400;if(this.hero.script.state==G.ROLE_STATE.CLIMB){let e=this.hero.script.curModel.transform.position;if(this.tempVec3.x=e.x-i,this.tempVec3.y=e.y,this.tempVec3.z=e.z,this.temp1Vec3.x=e.x-i,this.temp1Vec3.y=e.y,this.temp1Vec3.z=e.z+.3,!this.checkCollider(this.tempVec3,this.temp1Vec3,Laya.Physics3DUtils.COLLISIONFILTERGROUP_CUSTOMFILTER1))return}t.length>1&&(this.hero.transform.localPositionX-=i,this.hero.transform.localPositionX>t[0]?this.hero.transform.localPositionX=t[0]:this.hero.transform.localPositionX<t[1]&&(this.hero.transform.localPositionX=t[1]));let a=this.roadmodel.script.getCurRoad(this.hero.transform.position.z,this.hero.script.curModel.transform.position.x);if(a&&a!=this.hero.lastRoad){let e=a.script.getBezierPoint(this.hero.transform.position.z),t=this.hero.lastRoad.script.getBezierPoint(this.hero.transform.position.z);if(a.transform.position.y==this.hero.lastRoad.transform.position.y||Math.abs(e[1]+a.transform.localPositionY-(t[1]+this.hero.lastRoad.transform.localPositionY))<.001){this.hero.lastRoad=a,this.hero.parent.transform.localPositionY=a.transform.localPositionY,this.hero.parent.transform.localPositionX=a.transform.localPositionX;let e=a.script.getBezierPoint(this.heroBase.transform.position.z);e&&(this.hero.script.curModel.transform.localPositionX=e[0],this.hero.script.curModel.transform.localPositionY=e[1])}else this.hero.transform.localPositionX>this.hero.lastRoad.script.limitL?this.hero.transform.localPositionX=this.hero.lastRoad.script.limitL:this.hero.transform.localPositionX<this.hero.lastRoad.script.limitR&&(this.hero.transform.localPositionX=this.hero.lastRoad.script.limitR)}}this.lastX=e.stageX}}doClose(){super.doClose()}}class n extends e{constructor(){super()}initData(){this.tlArr=[],this.openNum=0;let e=[0,1,2,3,4,5,6,7,8];if(this.getIndex=[],Math.random()<.1){let t=dataManager.getNoOwn();this.getRewardID=t[utils.random(0,t.length-1)],this.rewardIndex=e[utils.random(0,8)]}this.coinArr=[];for(let e=0;e<9;e++)this.rewardIndex==e&&this.getRewardID?this.coinArr.push(0):this.coinArr.push(utils.random(3,10));for(let t=0;t<e.length;t++)e[t]==this.rewardIndex&&e.splice(t,1);for(this.freeIndexs=[];this.freeIndexs.length<3;){let t=utils.random(0,e.length-1);this.freeIndexs.push(e[t]),e.splice(t,1)}this.showAll=!1,console.log("随机序号",e),console.log("免费序号",this.freeIndexs),console.log("免费部件序号",this.rewardIndex)}initUI(){this.list.array=this.coinArr}initEvent(){utils.onBtnScaleEvent(this.btn_clsoe,this,()=>{this.showAll=!0,this.list.refresh(),Laya.timer.once(1500,this,()=>{this.doClose()})}),utils.listHandler(this.list,this,(e,t)=>{let i=e.dataSource,a=utils.getChildDeep(e,"box_ad"),s=utils.getChildDeep(a,"icon"),o=utils.getChildDeep(a,"video"),n=utils.getChildDeep(e,"box_buJian"),l=utils.getChildDeep(n,"icon"),r=utils.getChildDeep(e,"box_coin"),h=utils.getChildDeep(e,"num");n.visible=!1,r.visible=!1,h.visible=!1;for(let e=0;e<this.freeIndexs.length;e++)this.freeIndexs[e]==t&&(o.visible=!1);0==i?(l.skin=D.AnimalParts[this.getRewardID].icon2,h.text="x1"):h.text="x"+i,this.showAll&&(a.visible=!1,0==i?n.visible=!0:r.visible=!0,h.visible=!0),e.offAll(),utils.onBtnScaleEvent(e,this,()=>{for(let e=0;e<this.getIndex.length;e++)if(this.getIndex[e]==t)return;let e=()=>{this.getIndex.push(t),0==i?dataManager.addYaoJi(this.getRewardID):dataManager.setPlayerData("COIN",dataManager.getPlayerData("COIN")+i),s.skin="sdk/img_openBox.png";let e=new Laya.TimeLine;if(this.tlArr.push(e),e.to(a,{},300).to(a,{scaleX:0,scaleY:0},300).play(0,!1),e.on(Laya.Event.COMPLETE,this,()=>{e.pause(),e.destroy()}),0==i){n.scaleX=.2,n.scaleY=.2,n.visible=!0;let e=new Laya.TimeLine;this.tlArr.push(e),e.to(n,{},100).to(n,{scaleX:.8,scaleY:.8},300).play(0,!1),e.on(Laya.Event.COMPLETE,this,()=>{e.pause(),e.destroy(),h.visible=!0})}else{r.scaleX=.2,r.scaleY=.2,r.visible=!0;let e=new Laya.TimeLine;this.tlArr.push(e),e.to(r,{},100).to(r,{scaleX:1,scaleY:1},300).play(0,!1),e.on(Laya.Event.COMPLETE,this,()=>{e.pause(),e.destroy(),h.visible=!0})}};o.visible?window.uleeSDK?(audioManager.setMusicMuted(!1),uleeSDK.showVideoAD(()=>{e(),audioManager.huifuMusicMuted()},()=>{audioManager.huifuMusicMuted()})):e():(this.minusKey(),e())})},e=>{})}minusKey(){this.openNum++;let e=e=>{let t=new Laya.TimeLine;this.tlArr.push(t),t.to(e,{scaleX:0,scaleY:0},300).play(0,!1),t.on(Laya.Event.COMPLETE,this,()=>{t.pause(),t.destroy(),this.openNum})};1==this.openNum?e(utils.getChildDeep(this.box_keys,"key1")._children[0]):2==this.openNum?e(utils.getChildDeep(this.box_keys,"key2")._children[0]):3==this.openNum&&e(utils.getChildDeep(this.box_keys,"key3")._children[0])}doClose(){this.argObj&&this.argObj.callback&&this.argObj.callback();for(let e=0;e<this.tlArr.length;e++)this.tlArr[e]._tweenDic&&(this.tlArr[e].pause(),this.tlArr[e].destroy());super.doClose()}}class l extends e{constructor(){super(),G.ChangeUI=this}initData(){this.changeing=!1,this.selectIDArr=[],this.timeLineArr=[],this.curSkin=this.argObj.curSkin;let e=this.argObj.curSkin,t=Object.values(D.AnimalParts),i=[];for(let a=0;a<t.length;a++){let s=!1;for(let i=0;i<e.length;i++)if(t[a].id==e[i]){s=!0;break}s||i.push(t[a].id)}this.idArr=[];let a=[];for(;this.idArr.length<3;){let e=utils.random(0,i.length-1),t=i[e],s=!1;for(let e=0;e<a.length;e++)a[e]==D.AnimalParts[t].type2&&(s=!0);s||(a.push(D.AnimalParts[t].type2),this.idArr.push(t),i.splice(e,1))}}initUI(){this.list.array=this.idArr,this.initScene()}initEvent(){this.box_content.on(Laya.Event.MOUSE_DOWN,this,e=>{this.click_pos=e.stageX}),this.box_content.on(Laya.Event.MOUSE_MOVE,this,e=>{if(this.click_pos){let t=this.click_pos-e.stageX;this.heroBase.transform.localRotationEulerY+=t,this.click_pos=e.stageX}}),this.box_content.on(Laya.Event.MOUSE_UP,this,e=>{this.click_pos=null}),this.box_content.on(Laya.Event.MOUSE_OUT,this,e=>{this.click_pos=null}),utils.onBtnEvent(this.btn_close,this,()=>{this.changeing||this.doClose()}),utils.listHandler(this.list,this,(e,t)=>{let i=e.dataSource,a=utils.getChildDeep(e,"icon"),s=utils.getChildDeep(e,"tips"),o=utils.getChildDeep(e,"video");a.skin=D.AnimalParts[i].icon2,s.visible=dataManager.queryYaoJi(i),o.visible=!dataManager.queryYaoJi(i)},e=>{if(e<0)return;if(this.changeing)return;this.changeing=!0;let t=this.list.array[e];dataManager.queryYaoJi(t)?(this.changePart(t,!0),this.scaleAnim2()):(console.log("看视频"),window.uleeSDK?(audioManager.setMusicMuted(!1),uleeSDK.showVideoAD(()=>{this.changePart(t,!0),this.scaleAnim2(),audioManager.huifuMusicMuted(),audioManager.playMusic(4)},()=>{this.changeing=!1,audioManager.huifuMusicMuted(),audioManager.playMusic(4)})):(this.changePart(t,!0),this.scaleAnim2())),this.list.selectedIndex=-1})}scaleAnim2(){this.lab_close.text="Continue",this.img_close.gray=!1;let e=this.list._cells,t=0;for(let i=0;i<e.length;i++){let a=new Laya.TimeLine;a.to(e[i],{scaleX:1.05,scaleY:1.05},300).to(e[i],{scaleX:0,scaleY:0},300).play(0,!1),a.on(Laya.Event.COMPLETE,this,()=>{if(a.pause(),a.destroy(),++t>=e.length){let e=new Laya.TimeLine;e.to(this.btn_close,{bottom:480},300).play(0,!1),e.on(Laya.Event.COMPLETE,this,()=>{e.pause(),e.destroy(),this.changeing=!1})}})}}initScene(){this.newScene=this.addChild(new Laya.Scene3D),this.newScene.ambientColor=new Laya.Vector3(.7,.7,.7);var e=new Laya.DirectionLight;this.newScene.addChild(e),e.color=new Laya.Vector3(1,1,1),e.intensity=.38,e.transform.position=new Laya.Vector3(1.41,10.65,-17.23),e.transform.rotationEuler=new Laya.Vector3(-90,60,0),this.camera=cameraUtils.createCamera(new Laya.Vector3(.007,3.88,4.536),new Laya.Vector3(-17.18,2.9,0)),this.camera.fieldOfView=75,this.newScene.addChild(this.camera),this.createRole()}createRole(){let e=[30005,30007,30011],t=0;ModelCfg.getIns().getModelById(30006,i=>{this.newScene.addChild(i),this.heroBase=i,this.bodyModel=i,ModelCfg.getIns().setLocalPosition(i,-.3,2.35,-.9),ModelCfg.getIns().setLocalScale(i,2.1),ModelCfg.getIns().setLocalRotation(i,0,2,0);for(let a=0;a<e.length;a++)ModelCfg.getIns().getModelById(e[a],s=>{if(30005==e[a]?(this.handModel=s,this.handModel.modelID=30005):30007==e[a]?(this.headModel=s,this.headModel.modelID=30007):30011==e[a]&&(this.legModel=s,this.legModel.modelID=30011),i.addChild(s),++t>=e.length)for(let e=0;e<this.curSkin.length;e++)this.changePart(this.curSkin[e])})})}changePart(e,t){t&&(this.selectIDArr.push(e),this.changeing=!0);let i=D.AnimalParts[e];i.type;if("hand"==i.type2){if(this.handModel)if(30010==i.modelId){let e=utils.getChildDeep(this.handModel,"mixamorig:LeftArm"),a=utils.getChildDeep(this.handModel,"mixamorig:RightArm");ModelCfg.getIns().getModelById(i.modelId,s=>{this.bodyModel.addChild(s);let o=utils.getChildDeep(s,"Spider_Arms1"),n=utils.getChildDeep(s,"Spider_Arms2"),l=utils.getChildDeep(s,"Spider_Arms3"),r=utils.getChildDeep(o,"mixamorig:LeftArm"),h=utils.getChildDeep(o,"mixamorig:RightArm");t&&(r.transform.localScale=new Laya.Vector3(0,0,0),h.transform.localScale=new Laya.Vector3(0,0,0));let d=utils.getChildDeep(n,"mixamorig:LeftArm"),c=utils.getChildDeep(n,"mixamorig:RightArm");t&&(d.transform.localScale=new Laya.Vector3(0,0,0),c.transform.localScale=new Laya.Vector3(0,0,0));let u=utils.getChildDeep(l,"mixamorig:LeftArm"),m=utils.getChildDeep(l,"mixamorig:RightArm");t&&(u.transform.localScale=new Laya.Vector3(0,0,0),m.transform.localScale=new Laya.Vector3(0,0,0)),t?(this.scaleAnim(e,0),this.scaleAnim(a,0,()=>{this.handModel.destroy(),this.handModel=s,this.handModel.modelID=i.modelId,this.scaleAnim(r,1),this.scaleAnim(h,1,()=>{this.scaleAnim(d,1),this.scaleAnim(c,1,()=>{this.scaleAnim(u,1),this.scaleAnim(m,1,()=>{})})})})):(this.handModel.destroy(),this.handModel=s,this.handModel.modelID=i.modelId)})}else if(30010==this.handModel.modelID){let e=utils.getChildDeep(this.handModel,"Spider_Arms1"),a=utils.getChildDeep(this.handModel,"Spider_Arms2"),s=utils.getChildDeep(this.handModel,"Spider_Arms3"),o=utils.getChildDeep(e,"mixamorig:LeftArm"),n=utils.getChildDeep(e,"mixamorig:RightArm"),l=utils.getChildDeep(a,"mixamorig:LeftArm"),r=utils.getChildDeep(a,"mixamorig:RightArm"),h=utils.getChildDeep(s,"mixamorig:LeftArm"),d=utils.getChildDeep(s,"mixamorig:RightArm");ModelCfg.getIns().getModelById(i.modelId,e=>{this.bodyModel.addChild(e);let a=utils.getChildDeep(e,"mixamorig:LeftArm"),s=utils.getChildDeep(e,"mixamorig:RightArm");t&&(a.transform.localScale=new Laya.Vector3(0,0,0),s.transform.localScale=new Laya.Vector3(0,0,0)),t?(this.scaleAnim(o,0),this.scaleAnim(n,0),this.scaleAnim(l,0),this.scaleAnim(r,0),this.scaleAnim(h,0),this.scaleAnim(d,0,()=>{this.handModel.destroy(),this.handModel=e,this.handModel.modelID=i.modelId,this.scaleAnim(a,1),this.scaleAnim(s,1,()=>{})})):(this.handModel.destroy(),this.handModel=e,this.handModel.modelID=i.modelId)})}else{let e=utils.getChildDeep(this.handModel,"mixamorig:LeftArm"),a=utils.getChildDeep(this.handModel,"mixamorig:RightArm");ModelCfg.getIns().getModelById(i.modelId,s=>{this.bodyModel.addChild(s);let o=utils.getChildDeep(s,"mixamorig:LeftArm"),n=utils.getChildDeep(s,"mixamorig:RightArm");t&&(o.transform.localScale=new Laya.Vector3(0,0,0),n.transform.localScale=new Laya.Vector3(0,0,0)),t?(this.scaleAnim(e,0),this.scaleAnim(a,0,()=>{this.handModel.destroy(),this.handModel=s,this.handModel.modelID=i.modelId,this.scaleAnim(o,1),this.scaleAnim(n,1,()=>{})})):(this.handModel.destroy(),this.handModel=s,this.handModel.modelID=i.modelId)})}}else if("head"==i.type2){let e=utils.getChildDeep(this.headModel,"mixamorig:Head");ModelCfg.getIns().getModelById(i.modelId,a=>{this.bodyModel.addChild(a);let s=utils.getChildDeep(a,"mixamorig:Head");t&&(s.transform.localScale=new Laya.Vector3(0,0,0)),t?this.scaleAnim(e,0,()=>{this.headModel.destroy(),this.headModel=a,this.headModel.modelID=i.modelId,this.scaleAnim(s,1,()=>{})}):(this.headModel.destroy(),this.headModel=a,this.headModel.modelID=i.modelId)})}else if("leg"==i.type2){let e=utils.getChildDeep(this.legModel,"mixamorig:LeftUpLeg"),a=utils.getChildDeep(this.legModel,"mixamorig:RightUpLeg");this.legModel.modelID==i.modelId?i.pic&&(t?(this.scaleAnim(e,0),this.scaleAnim(a,0,()=>{ModelCfg.getIns().setMaterialPic(this.legModel,i.pic),this.scaleAnim(e,1),this.scaleAnim(a,1,()=>{})})):ModelCfg.getIns().setMaterialPic(this.legModel,i.pic)):ModelCfg.getIns().getModelById(i.modelId,s=>{this.bodyModel.addChild(s);let o=utils.getChildDeep(s,"mixamorig:LeftUpLeg"),n=utils.getChildDeep(s,"mixamorig:RightUpLeg");t&&(o.transform.localScale=new Laya.Vector3(0,0,0),n.transform.localScale=new Laya.Vector3(0,0,0)),t?(this.scaleAnim(e,0),this.scaleAnim(a,0,()=>{this.legModel.destroy(),this.legModel=s,this.legModel.modelID=i.modelId,i.pic&&ModelCfg.getIns().setMaterialPic(this.legModel,i.pic),this.scaleAnim(o,1),this.scaleAnim(n,1,()=>{})})):(this.legModel.destroy(),this.legModel=s,this.legModel.modelID=i.modelId,i.pic&&ModelCfg.getIns().setMaterialPic(this.legModel,i.pic))})}else"bei"==i.type2?this.beiModel?ModelCfg.getIns().getModelById(i.modelId,e=>{utils.getChildDeep(this.bodyModel,i.bone).addChild(e);let a=e.transform.localScale.x;t?(ModelCfg.getIns().setLocalScale(e,0,0,0),this.scaleAnim(this.beiModel,0,()=>{this.scaleAnim(e,a,()=>{}),this.beiModel=e})):this.beiModel=e}):ModelCfg.getIns().getModelById(i.modelId,e=>{utils.getChildDeep(this.bodyModel,i.bone).addChild(e),this.beiModel=e;let a=e.transform.localScale.x;t&&(ModelCfg.getIns().setLocalScale(e,0,0,0),this.scaleAnim(e,a,()=>{}))}):ModelCfg.getIns().getModelById(i.modelId,e=>{utils.getChildDeep(this.bodyModel,i.bone).addChild(e);let a=e.transform.localScale.x;t&&(ModelCfg.getIns().setLocalScale(e,0,0,0),this.scaleAnim(e,a,()=>{}))})}scaleAnim(e,t,i){0==t?audioManager.playSound(5,null,!1):1==t&&audioManager.playSound(6,null,!1);let a=new Laya.TimeLine;this.timeLineArr.push(a),a.to(e.transform,{localScaleX:t,localScaleY:t,localScaleZ:t},300).play(0,!1),a.on(Laya.Event.COMPLETE,this,()=>{a.pause(),a.destroy(),i&&i()})}doClose(){this.argObj&&this.argObj.callback&&this.argObj.callback(this.selectIDArr);for(let e=0;e<this.timeLineArr.length;e++)this.timeLineArr[e].pause();G.ChangeUI=null,super.doClose()}}class r extends e{constructor(){super(),G.CLICKUI=this}initData(){this.progress=0}initUI(){this.loop=updateManager.timeLoop(1,this,()=>{G.ISHIDE||(G.CLICKUI_CLOSE?this.doClose():(this.progress<0?this.progress=.1:this.progress-=12,this.updateBar()))})}initEvent(){utils.onBtnScaleEvent(this.btn_click,this,()=>{this.progress+=15,this.progress>=40&&(this.isShow||window.uleeSDK&&(console.log("显示banner"),uleeSDK.showAD(!0),this.isShow=!0,Laya.timer.once(2e3,this,()=>{console.log("隐藏banner"),uleeSDK.showAD(!1)}))),this.progress>=100&&(this.progress=100,updateManager.clear(this.loop,this),Laya.timer.once(500,this,()=>{this.doClose()})),this.updateBar()})}updateBar(){Laya.Tween.to(this.img_bar,{width:this.progress/100*463},300)}doClose(){G.CLICKUI_CLOSE=!1,G.CLICKUI=null,window.uleeSDK&&uleeSDK.showAD(!1),this.argObj&&this.argObj.callback&&this.argObj.callback(),super.doClose()}}class h extends e{constructor(){super()}initData(){this.rewardID=dataManager.getRewardID(),this.level=dataManager.getPlayerData("level"),1==this.level?this.addVal=100:2==this.level||3==this.level?this.addVal=50:this.addVal=33.5,this.newID=null}initUI(){this.label_level.text="Level "+this.level,this.btn_get.visible=!1,this.label_tag.visible=!1,this.box_tag.visible=!1,this.box_icon.visible=!1,this.rewardID?(this.box_icon.visible=!0,this.btn_next.visible=!1,this.btn_video.visible=!1):(this.btn_next.visible=!0,this.btn_video.visible=!0),dataManager.upLevel(),window.uleeSDK?(this.updateReward(),window.uleeSDK&&(uleeSDK.showInterstitialAD(()=>{}),"tt"==uleeSDK.pf&&uleeSDK.showInterstitialAD(()=>{})),this.box_btn.y=Laya.stage.height-100,this.isMoveBtn=!0,this.canTouch=!0):(this.updateReward(),this.isMoveBtn=!0,this.canTouch=!0),this.showBottomAD()}jumpTo(e){let t=e.target.gameData;uleeSDK.jumpToApp(t,function(){console.log("跳转成功")})}updateAD(){let e=G.clone(uleeSDK.zsOutAD);for(var t=0;t<6;t++){let i=tools.shiftRandom(e),a=this["img_out"+t];a.getChildByName("img_frame").skin=i.logo,a.getChildByName("label_name").text=i.name,a.gameData=i}}initEvent(){utils.onBtnScaleEvent(this.btn_video,this,()=>{window.uleeSDK&&(audioManager.setMusicMuted(!1),uleeSDK.showVideoAD(function(){this.newID=this.rewardID,dataManager.addYaoJi(this.rewardID),dataManager.setPlayerData("progressBar",.1),audioManager.playSound(12,null,!1),this.doClose(),console.log("领取了奖励"),audioManager.huifuMusicMuted()}.bind(this),function(){audioManager.huifuMusicMuted()}))}),utils.onBtnScaleEvent(this.btn_next,this,()=>{this.canTouch&&(audioManager.playSound(12,null,!1),this.doClose())}),utils.onBtnScaleEvent(this.btn_get,this,()=>{this.canTouch&&(audioManager.playSound(12,null,!1),this.doClose())})}moveBtn(){this.isMoveBtn=!0,Laya.timer.once(1e3,this,function(){uleeSDK.showAD2(!0),Laya.timer.once(1e3*parseFloat(uleeSDK.getZSONOFF("zs_banner_time")),this,function(){uleeSDK.showAD2(!1),this.canTouch=!0})})}updateReward(){let e=this.rewardID;if(!e)return void(this.box_icon.visible=!1);let t=D.AnimalParts[e].icon2,i=utils.getChildDeep(this.box_icon,"img_icon"),a=utils.getChildDeep(this.box_icon,"panel_mask"),s=utils.getChildDeep(this.box_icon,"img_mask_icon"),o=utils.getChildDeep(this.box_icon,"box_num"),n=utils.getChildDeep(this.box_icon,"label_num");n.visible=!0,i.skin=t,s.skin=t,i.scaleX=1.5,i.scaleY=1.5,s.scaleX=1.5,s.scaleY=-1.5;let l=1.5*i.width,r=1.5*i.height;this.box_icon.width=l,this.box_icon.height=r,a.width=l,a.y=r,s.y=r,a.height=.1;let h=dataManager.getPlayerData("progressBar")+this.addVal;a.height=dataManager.getPlayerData("progressBar")/100*r,n.text=parseInt(dataManager.getPlayerData("progressBar"))+"%";let d=new Laya.TimeLine;d.to(a,{height:h/100*r},300).play(0,!1),d.on(Laya.Event.COMPLETE,this,()=>{d.pause(),d.reset(),n.text=parseInt(h)+"%",dataManager.setPlayerData("progressBar",h),h>=100?(d.to(o,{scaleX:0,scaleY:0},200).play(0,!1),d.on(Laya.Event.COMPLETE,this,()=>{d.pause(),d.reset(),d.to(this.box_icon,{scaleX:.9,scaleY:.9},100).to(this.box_icon,{scaleX:1.3,scaleY:1.3},200).to(this.box_icon,{scaleX:1.1,scaleY:1.1},100).to(this.box_icon,{scaleX:1.2,scaleY:1.2},200).to(this.box_icon,{scaleX:1,scaleY:1},100).play(0,!1),d.on(Laya.Event.COMPLETE,this,()=>{d.pause(),d.destroy(),this.btn_get.visible=!0,this.label_tag.visible=!0,this.box_tag.visible=!0})}),this.newID=this.rewardID,dataManager.addYaoJi(e),dataManager.setPlayerData("progressBar",.1)):(this.btn_next.visible=!0,this.btn_video.visible=!0)})}showBottomAD(){this.box_mAD.visible=!1,window.uleeSDK&&("oppo"==uleeSDK.pf?(this.customID=uleeSDK.getCustomAdId(),uleeSDK.createCustomAd(this.customID,Laya.stage.width/8,.5*Laya.stage.height,!0,null,null)):"vivo"==uleeSDK.pf&&(this.customID=uleeSDK.getCustomAdId(),uleeSDK.createCustomAd(this.customID,0,.5*Laya.stage.height,!0,null,null)))}doClose(){this.argObj&&this.argObj.callback&&this.argObj.callback(),window.uleeSDK&&("vivo"!=uleeSDK.pf&&"oppo"!=uleeSDK.pf||(uleeSDK.closeCustomAd(this.customID),this.customID=null)),uiManager.openUI("gameView/HomeView.scene",null,{newID:this.newID});let e=uiManager.getUI("gameView/HomeView.scene");uiManager.openUI("gameView/TlView.scene",e),e.visible=!0,super.doClose()}}class d extends e{constructor(){super(),G.HomeUI=this}initData(){this.addShuXingArr=[],this.showADTime=0}initUI(){this.visible=!1,this.argObj&&this.argObj.callback?this.argObj.callback():audioManager.playMusic(11),this.updateListHeight(),window.uleeSDK&&(uleeSDK.showAD(!0),this.img_outAD.visible=!1,"oppo"==uleeSDK.pf?(this.btn_ys.visible=!0,uleeSDK.showAD(!0)):"vivo"==uleeSDK.pf&&(this.btn_ys.visible=!0,this.showBottomAD()))}showOutAD(){uleeSDK.zsOutAD&&(this.curOut=tools.arrayRandom(uleeSDK.zsOutAD),this.img_icon.skin=this.curOut.app_icon,this.ani1.play(0,!1))}initEvent(){this.on(Laya.Event.MOUSE_DOWN,this,function(){G.YaoJiScript.guideCD=5,this.box_hand._children[0].visible=!1,this.ani2.stop()}),utils.onBtnEvent(this.img_outAD,this,function(){this.curOut&&zs.sdk.navigate2Mini(this.curOut,uleeSDK.openid,function(){console.log("跳转成功")})}),utils.onBtnScaleEvent(this.btn_more,this,function(){window.uleeSDK&&uleeSDK.showNative(uleeSDK.gridId)}),utils.onBtnScaleEvent(this.btn_ys,this,()=>{uiManager.getUI("gameView/YSView.scene").openView()}),utils.onBtnScaleEvent(this.btn_vlog,this,function(){this.startRecorder?utils.prompt("已开启录屏,请勿重复操作"):window.uleeSDK&&(this.startRecorder=!0,"tt"==uleeSDK.pf&&uleeSDK.stratGameRecorder(()=>{utils.prompt("开始录制视频")},()=>{utils.prompt("当前无法录制视频,请稍后再试")}))}),utils.onBtnScaleEvent(this.box_start,this,()=>{if(audioManager.playSound(13,null,!1),!G.YaoJiScript.playerAnim&&!G.HomeScript.changeing){if(dataManager.getPlayerData("TL")<2)return utils.prompt("Insufficient HP"),void G.TLUI.check();if(dataManager.getPlayerData("WUXIAN")||dataManager.setPlayerData("TL",dataManager.getPlayerData("TL")-1),G.HomeScript.startGame){let e=()=>{window.uleeSDK&&(this.startRecorder||"tt"==uleeSDK.pf&&uleeSDK.stratGameRecorder());let e=G.YaoJiScript.getYaoJi();uiManager.openUI("gameView/BattleView.scene",null,{parts:e}),audioManager.stopMusic(),audioManager.playMusic(4),this.doClose()};window.uleeSDK,e()}else utils.prompt("At Least 2 or more Wearing Parts")}}),utils.listHandler(this.list,this,(e,t)=>{let i=e.dataSource,a=utils.getChildDeep(e,"img_bg"),s=utils.getChildDeep(e,"img_icon");if(5==i&&(s.scaleY=.2),this.getOwn(i)){if(a.skin="common/img_field_element_right1.png",s.skin=D.lzConfig[i].icon2,!e.anim){e.anim=!0;let t=new Laya.TimeLine;t.to(e,{scaleX:1.3,scaleY:1.3},300).to(e,{scaleX:1,scaleY:1},500).play(0,!1),t.on(Laya.Event.COMPLETE,this,()=>{t.pause(),t.destroy()})}}else a.skin="common/img_field_element_right.png",s.skin=D.lzConfig[i].icon},e=>{})}getOwn(e){for(let t=0;t<this.addShuXingArr.length;t++)if(this.addShuXingArr[t]==e)return!0;return!1}updateListHeight(){let e=D.RoundConfig[dataManager.getPlayerData("level")];if(e){let t=e.roomArr;this.list.height=85*t.length-10+50,this.list.array=t}else this.list.array=[]}udpateShuXing(e){this.addShuXingArr.push(e),this.list.refresh()}showBottomAD(){this.box_bottomAD.visible=!1,window.uleeSDK&&("oppo"!=uleeSDK.pf&&"vivo"!=uleeSDK.pf||G.NATIVE_TIME&&("oppo"==uleeSDK.pf||"vivo"==uleeSDK.pf&&(this.customID=uleeSDK.getCustomAdId(),uleeSDK.createCustomAd(this.customID,null,null,!0,()=>{G.totalShowADTime+=(new Date).getTime()-this.showADTime,this.showADTime=0,this.customID=null},()=>{0==this.showADTime&&(this.showADTime=(new Date).getTime())})),updateManager.timeLoop(60,this,()=>{"vivo"==uleeSDK.pf&&this.customID&&(uleeSDK.closeCustomAd(this.customID),this.customID=null),this.showBottomAD()})))}doClose(){G.HomeUI=null,0!=this.showADTime&&(G.totalShowADTime+=(new Date).getTime()-this.showADTime,this.showADTime=0),window.uleeSDK&&(uleeSDK.showAD(!1),"vivo"==uleeSDK.pf?this.customID&&(uleeSDK.closeCustomAd(this.customID),this.customID=null):"oppo"==uleeSDK.pf&&uleeSDK.showAD(!1)),updateManager.clearAll(this),super.doClose()}}class c{constructor(){this.filePath="res/",this.initModelId=[],this.scale={},this.pos={},this.models={}}getModelUrlByName(e){return this.filePath+e+".lh"}getInitModelNames(){let e=[],t=this.initModelId;for(let i=0;i<t.length;i++){let a=D.PrefabsPath[t[i]].chs;this.scale[a]=D.PrefabsPath[t[i]].scale,0!=D.PrefabsPath[t[i]].pos&&(this.pos[a]=D.PrefabsPath[t[i]].pos.split("#")),e.push(a)}return e}getInitModelUrls(){let e=[],t=this.initModelId;for(let i=0;i<t.length;i++){let a=D.PrefabsPath[t[i]].chs;this.scale[a]=D.PrefabsPath[t[i]].scale,this.pos[a]=D.PrefabsPath[t[i]].pos.split("#"),e.push(this.getModelUrlByName(a))}return e}initModels(e=null){let t=this.getInitModelUrls();Laya.loader.create(t,new Laya.Handler(this,function(){let i=this.getInitModelNames();for(let e=0;e<i.length;e++)this.models[i[e]]=Laya.loader.getRes(t[e].url);e&&e()}))}loadModel(e,t){let i=this.getModelUrlByName(e);Laya.loader.create([i],new Laya.Handler(this,function(){this.models[e]=Laya.loader.getRes(i);let a=this.models[e].clone();this.setLocalScale(a,this.scale[e]),this.pos[e].length>1&&this.setLocalPosition(a,parseFloat(this.pos[e][0]),parseFloat(this.pos[e][1]),parseFloat(this.pos[e][2])),t&&t(a)}))}getModelByName(e,t){let i=this.models[e];if(!i)return this.loadModel(e,t);{let a=i.clone();this.setLocalScale(a,this.scale[e]),this.pos[e].length>1&&this.setLocalPosition(a,parseFloat(this.pos[e][0]),parseFloat(this.pos[e][1]),parseFloat(this.pos[e][2])),t(a)}}getModelById(e,t){let i=D.PrefabsPath[e].chs;return this.scale[i]=D.PrefabsPath[e].scale,this.pos[i]=D.PrefabsPath[e].pos.split("#"),this.getModelByName(i,t)}getPosition(e){return e.transform._localPosition}setLocalPosition(e,t,i,a){let s=e.transform._localPosition;s.x=t,s.y=i,s.z=a,e.transform.localPosition=e.transform._localPosition}setLocalScale(e,t,i,a){void 0===t&&(t=1),void 0===i&&(i=t),void 0===a&&(a=t);let s=e.transform._localScale;s.x=t,s.y=i,s.z=a,e.transform.localScale=e.transform._localScale}setLocalRotation(e,t,i,a){if(!e)return;e.angleV3||(e.angleV3=new Laya.Vector3,e.radV3=new Laya.Vector3),e.angleV3.x=i,e.angleV3.y=t,e.angleV3.z=a;let s=e.radV3;s.x=i*Math.RAD_1_ANGLE,s.y=t*Math.RAD_1_ANGLE,s.z=a*Math.RAD_1_ANGLE;var o=e.transform;Laya.Quaternion.createFromYawPitchRoll(s.x,s.y,s.z,o._localRotation),o.localRotation=o._localRotation}setAlpha(e,t){e&&e._alpha!=t&&(this.setAlalbedo(e,t),this._alpha=t)}setAlalbedo(e,t,i,a,s){if(e){var o=e.meshRenderer||e.skinnedMeshRenderer;if(o)for(var n=o.materials,l=n.length-1;l>=0;l--){var r=n[l];0==r.cull&&1==r.blend&&770==r.srcBlend&&1==r.dstBlend||(t<1&&(r.renderMode=Laya[r.constructor.name].RENDERMODE_TRANSPARENT),void 0===i&&(i=r.albedoColorR),void 0===a&&(a=r.albedoColorG),void 0===s&&(s=r.albedoColorB),r.albedoColorA=t,r.albedoColorR=i,r.albedoColorG=a,r.albedoColorB=s)}else for(var h=0;h<e.numChildren;h++){var d=e.getChildAt(h);this.setAlalbedo(d,t,i,a,s)}}}receiveShadow(e){for(var t=0;t<e.numChildren;t++){var i=e.getChildAt(t);i instanceof Laya.MeshSprite3D?i.meshRender.receiveShadow=!0:i instanceof Laya.SkinnedMeshSprite3D&&(i.skinnedMeshRender.receiveShadow=!0)}}showShashow(e,t){t=null==t||t;for(var i=0;i<e.numChildren;i++){var a=e.getChildAt(i);a instanceof Laya.MeshSprite3D?a.meshRender.castShadow=t:a instanceof Laya.SkinnedMeshSprite3D&&(a.skinnedMeshRender.castShadow=t),a.numChildren>0&&this.showShashow(a,t)}}playAnim(e,i,a,s,o,n,l){if(!e||e.destroyed)return;let r=e.getChildAt(0).getComponent(Laya.Animator);if(l||(l=0),r){n?r.crossFade(i,n,l):r.play(i,l);var h=r._controllerLayers[0]._statesMap[i];h.script||(h.addScript(t),h.script=h._scripts[0]),o||(o=1),h.speed=o,s&&(s=s.bind(a)),h.script.setComplete(s),e.curAnim=i,e.curAnimSpeed=o}else console.error(e,"动作控制器未加载！"),s&&s.call(a)}stopAnim(e,t){let i=e.getChildAt(0).getComponent(Laya.Animator);i&&(t||(t=e.curAnim),t&&(i._controllerLayers[0]._statesMap[t].speed=0))}clearAnim(e){e.getChildAt(0).getComponent(Laya.Animator)._controllerLayers[0]._statesMap=[]}setMaterialPic(e,t){if(e&&t){if(e instanceof Laya.MeshSprite3D)var i=e.meshRenderer;else if(e instanceof Laya.SkinnedMeshSprite3D)i=e.skinnedMeshRenderer;if(i)if(i.material)Laya.Texture2D.load(t,Laya.Handler.create(this,function(e){null!=i._owner&&(i.material.albedoTexture=e)}));else{var a=new Laya.BlinnPhongMaterial;Laya.Texture2D.load(t,Laya.Handler.create(this,function(e){a.albedoTexture=e,a.albedoIntensity=1})),i.material=a}for(var s=0;s<e.numChildren;s++)this.setMaterialPic(e._children[s],t)}}addMeshCollider(e,t){if(t||(e.colliders=[],t=e.colliders),e.meshFilter){var i=e.addComponent(Laya.PhysicsCollider);let a=new Laya.MeshColliderShape;a.mesh=e.meshFilter.sharedMesh,i.colliderShape=a,t.push(i)}for(var a=e.numChildren,s=0;s<a;s++)this.addMeshCollider(e._children[s],t)}static getIns(){return this._ins||(this._ins=new c),this._ins}}window.ModelCfg=c;class u{constructor(){}copy(e){this.copyForm(this,e)}save(){let e={};this.copyForm2(e,this),dataManager.setStorage(e)}copyForm(e,t){for(let i in t)e[i]=t[i]}copyForm2(e,t){for(let i in t)"string"!=typeof t[i]&&"number"!=typeof t[i]&&"boolean"!=typeof t[i]&&"object"!=typeof t[i]||(e[i]=t[i])}}class m extends u{constructor(){super(),this.inGameTime=(new Date).getTime(),this.level=1,this.roundNum=1,this.ownMedicament="7,12",this.progressBar=.1,this.tongGuan=!1,this.isSound=!0,this.TL=1,this.COIN=0,this.LOOK=0,this.WUXIAN=!1,this.YSOK=!1}copy(e){super.copy(e);let t=new Date,i=t.getFullYear()+"_"+t.getMonth()+"_"+t.getDate();i!=this.day&&(this.day=i,this.save())}static getIns(){return this._ins||(this._ins=new m),this._ins}}class g extends Laya.Script{constructor(){super()}onAwake(){G.HomeScript=this,this.initData(),this.initEvent()}initData(){this.homeUI=this.owner._scene,this.startGame=!1,this.bodyModel=null,this.headModel=null,this.handModel=null,this.legModel=null,this.beiModel=null,this.timeLineArr=[],this.changeing=!1,dataManager.getPlayerData("isSound")?this.homeUI.btn_sound.skin="common/img_sound_on.png":this.homeUI.btn_sound.skin="common/img_sound_off.png"}initEvent(){utils.onBtnScaleEvent(this.homeUI.btn_sound,this,function(){dataManager.getPlayerData("isSound")?(dataManager.setPlayerData("isSound",!1),audioManager.setMusicMuted(!1),this.homeUI.btn_sound.skin="common/img_sound_off.png"):(dataManager.setPlayerData("isSound",!0),audioManager.setMusicMuted(!0),this.homeUI.btn_sound.skin="common/img_sound_on.png")}),this.owner.on(Laya.Event.MOUSE_DOWN,this,this.onDown),this.owner.on(Laya.Event.MOUSE_MOVE,this,this.onMove),this.owner.on(Laya.Event.MOUSE_UP,this,this.onUp),this.owner.on(Laya.Event.MOUSE_OUT,this,this.onUp)}onEnable(){this.newScene=this.owner.addChild(new Laya.Scene3D),this.newScene.ambientColor=new Laya.Vector3(.7,.7,.7);var e=new Laya.DirectionLight;this.newScene.addChild(e),e.color=new Laya.Vector3(1,1,1),e.intensity=.38,e.transform.position=new Laya.Vector3(1.41,10.65,-17.23),e.transform.rotationEuler=new Laya.Vector3(-90,60,0),this.camera=cameraUtils.createCamera(new Laya.Vector3(.007,3.58,4.536),new Laya.Vector3(-17.18,2.9,0)),this.camera.fieldOfView=75,this.newScene.addChild(this.camera),this.initScene(),this.createRole(),this.initZhen()}initScene(){c.getIns().getModelById(10001,function(e){this.newScene.addChild(e),c.getIns().setLocalPosition(e,0,2,0)}.bind(this)),c.getIns().getModelById(40012,function(e){this.newScene.addChild(e),c.getIns().setLocalPosition(e,-2.8,1.3,-3.5),this.bubble=e}.bind(this))}createRole(){let e=[30005,30007,30011];c.getIns().getModelById(30006,t=>{this.newScene.addChild(t),this.heroBase=t,this.bodyModel=t,Laya.Browser.onQGMiniGame||Laya.Browser.onVVMiniGame||this.setMatCap("res/tex/MaCrea_3.png"),c.getIns().setLocalPosition(t,-.23,1.5,-.9),c.getIns().setLocalScale(t,2.7),c.getIns().setLocalRotation(t,0,2,0);for(let i=0;i<e.length;i++)c.getIns().getModelById(e[i],a=>{30005==e[i]?(this.handModel=a,this.handModel.modelID=30005,Laya.Browser.onQGMiniGame||Laya.Browser.onVVMiniGame||Laya.Texture2D.load("res/tex/MaCrea_3.png",Laya.Handler.create(this,function(e){this.queryMat(this.handModel,e)}))):30007==e[i]?(this.headModel=a,this.headModel.modelID=30007,Laya.Browser.onQGMiniGame||Laya.Browser.onVVMiniGame||Laya.Texture2D.load("res/tex/MaCrea_3.png",Laya.Handler.create(this,function(e){this.queryMat(this.headModel,e)}))):30011==e[i]&&(this.legModel=a,this.legModel.modelID=30011,Laya.Browser.onQGMiniGame||Laya.Browser.onVVMiniGame||Laya.Texture2D.load("res/tex/MaCrea_3.png",Laya.Handler.create(this,function(e){this.queryMat(this.legModel,e)}))),t.addChild(a)})})}setMatCap(e){this.curMatPath=e,Laya.Texture2D.load(e,Laya.Handler.create(this,function(e){this.queryMat(this.heroBase,e)}))}queryMat(e,t){if(e.meshRenderer?e.meshRenderer.material.matCapTexture=t:e.skinnedMeshRenderer&&(e.skinnedMeshRenderer.material.matCapTexture=t),e._children.length>0)for(let i=0;i<e._children.length;i++)this.queryMat(e._children[i],t)}initRole(){utils.getChildDeep(this.heroBase,"Elephant_Head"),utils.getChildDeep(this.heroBase,"Frog_Arms"),utils.getChildDeep(this.heroBase,"Cheetah_Legs"),utils.getChildDeep(this.heroBase,"Giraffe_Head"),utils.getChildDeep(this.heroBase,"Monkey_Arms"),utils.getChildDeep(this.heroBase,"Rhino_Head");let e=utils.getChildDeep(this.heroBase,"Sharke"),t=(utils.getChildDeep(this.heroBase,"Human_Body"),utils.getChildDeep(this.heroBase,"Human_Legs")),i=utils.getChildDeep(this.heroBase,"Human_Head"),a=utils.getChildDeep(this.heroBase,"Human_Arms"),s=utils.getChildDeep(this.heroBase,"Crocodile_Tail"),o=utils.getChildDeep(this.heroBase,"Turtle_Shell_Back"),n=utils.getChildDeep(this.heroBase,"Eagle_Wings");utils.getChildDeep(this.heroBase,"Spider_Arms");e.active=!1,n.active=!1,s.active=!1,o.active=!1,this.curArms=a,this.curHead=i,this.curLegs=t,this.BeiBu=null;for(var l=0;l<this.heroBase._children.length;l++){let e=this.heroBase._children[l];e.name.indexOf("Human")>-1?e.active=!0:e.active=!1}}changePart(e){this.changeing=!0;let t=D.AnimalParts[e],i=t.type;if("hand"==t.type2){if(this.handModel)if(30010==t.modelId){let e=utils.getChildDeep(this.handModel,"mixamorig:LeftArm"),i=utils.getChildDeep(this.handModel,"mixamorig:RightArm");c.getIns().getModelById(t.modelId,a=>{this.bodyModel.addChild(a);let s=utils.getChildDeep(a,"Spider_Arms1"),o=utils.getChildDeep(a,"Spider_Arms2"),n=utils.getChildDeep(a,"Spider_Arms3"),l=utils.getChildDeep(s,"mixamorig:LeftArm"),r=utils.getChildDeep(s,"mixamorig:RightArm");l.transform.localScale=new Laya.Vector3(0,0,0),r.transform.localScale=new Laya.Vector3(0,0,0);let h=utils.getChildDeep(o,"mixamorig:LeftArm"),d=utils.getChildDeep(o,"mixamorig:RightArm");h.transform.localScale=new Laya.Vector3(0,0,0),d.transform.localScale=new Laya.Vector3(0,0,0);let c=utils.getChildDeep(n,"mixamorig:LeftArm"),u=utils.getChildDeep(n,"mixamorig:RightArm");c.transform.localScale=new Laya.Vector3(0,0,0),u.transform.localScale=new Laya.Vector3(0,0,0),this.scaleAnim(e,0),this.scaleAnim(i,0,()=>{this.handModel.destroy(),this.handModel=a,this.handModel.modelID=t.modelId,this.scaleAnim(l,1),this.scaleAnim(r,1,()=>{this.scaleAnim(h,1),this.scaleAnim(d,1,()=>{this.scaleAnim(c,1),this.scaleAnim(u,1,()=>{this.changeing=!1})})})})})}else if(30010==this.handModel.modelID){let e=utils.getChildDeep(this.handModel,"Spider_Arms1"),i=utils.getChildDeep(this.handModel,"Spider_Arms2"),a=utils.getChildDeep(this.handModel,"Spider_Arms3"),s=utils.getChildDeep(e,"mixamorig:LeftArm"),o=utils.getChildDeep(e,"mixamorig:RightArm"),n=utils.getChildDeep(i,"mixamorig:LeftArm"),l=utils.getChildDeep(i,"mixamorig:RightArm"),r=utils.getChildDeep(a,"mixamorig:LeftArm"),h=utils.getChildDeep(a,"mixamorig:RightArm");c.getIns().getModelById(t.modelId,e=>{this.bodyModel.addChild(e);let i=utils.getChildDeep(e,"mixamorig:LeftArm"),a=utils.getChildDeep(e,"mixamorig:RightArm");i.transform.localScale=new Laya.Vector3(0,0,0),a.transform.localScale=new Laya.Vector3(0,0,0),this.scaleAnim(s,0),this.scaleAnim(o,0),this.scaleAnim(n,0),this.scaleAnim(l,0),this.scaleAnim(r,0),this.scaleAnim(h,0,()=>{this.handModel.destroy(),this.handModel=e,this.handModel.modelID=t.modelId,this.scaleAnim(i,1),this.scaleAnim(a,1,()=>{this.changeing=!1})})})}else{let e=utils.getChildDeep(this.handModel,"mixamorig:LeftArm"),i=utils.getChildDeep(this.handModel,"mixamorig:RightArm");c.getIns().getModelById(t.modelId,a=>{this.bodyModel.addChild(a);let s=utils.getChildDeep(a,"mixamorig:LeftArm"),o=utils.getChildDeep(a,"mixamorig:RightArm");s.transform.localScale=new Laya.Vector3(0,0,0),o.transform.localScale=new Laya.Vector3(0,0,0),this.scaleAnim(e,0),this.scaleAnim(i,0,()=>{this.handModel.destroy(),this.handModel=a,this.handModel.modelID=t.modelId,this.scaleAnim(s,1),this.scaleAnim(o,1,()=>{this.changeing=!1})})})}}else if("head"==t.type2){let e=utils.getChildDeep(this.headModel,"mixamorig:Head");c.getIns().getModelById(t.modelId,i=>{this.bodyModel.addChild(i);let a=utils.getChildDeep(i,"mixamorig:Head");a.transform.localScale=new Laya.Vector3(0,0,0),this.scaleAnim(e,0,()=>{this.headModel.destroy(),this.headModel=i,this.headModel.modelID=t.modelId,this.scaleAnim(a,1,()=>{this.changeing=!1})})})}else if("leg"==t.type2){let e=utils.getChildDeep(this.legModel,"mixamorig:LeftUpLeg"),i=utils.getChildDeep(this.legModel,"mixamorig:RightUpLeg");this.legModel.modelID==t.modelId?t.pic&&(this.scaleAnim(e,0),this.scaleAnim(i,0,()=>{c.getIns().setMaterialPic(this.legModel,t.pic),this.scaleAnim(e,1),this.scaleAnim(i,1,()=>{this.changeing=!1})})):c.getIns().getModelById(t.modelId,a=>{this.bodyModel.addChild(a);let s=utils.getChildDeep(a,"mixamorig:LeftUpLeg"),o=utils.getChildDeep(a,"mixamorig:RightUpLeg");s.transform.localScale=new Laya.Vector3(0,0,0),o.transform.localScale=new Laya.Vector3(0,0,0),this.scaleAnim(e,0),this.scaleAnim(i,0,()=>{this.legModel.destroy(),this.legModel=a,this.legModel.modelID=t.modelId,t.pic&&c.getIns().setMaterialPic(this.legModel,t.pic),this.scaleAnim(s,1),this.scaleAnim(o,1,()=>{this.changeing=!1})})})}else"bei"==t.type2?this.beiModel?c.getIns().getModelById(t.modelId,e=>{utils.getChildDeep(this.bodyModel,t.bone).addChild(e);let i=e.transform.localScale.x;c.getIns().setLocalScale(e,0,0,0),this.scaleAnim(this.beiModel,0,()=>{this.scaleAnim(e,i,()=>{this.changeing=!1}),this.beiModel=e})}):c.getIns().getModelById(t.modelId,e=>{utils.getChildDeep(this.bodyModel,t.bone).addChild(e),this.beiModel=e;let i=e.transform.localScale.x;c.getIns().setLocalScale(e,0,0,0),this.scaleAnim(e,i,()=>{this.changeing=!1})}):c.getIns().getModelById(t.modelId,e=>{utils.getChildDeep(this.bodyModel,t.bone).addChild(e);let i=e.transform.localScale.x;c.getIns().setLocalScale(e,0,0,0),this.scaleAnim(e,i,()=>{this.changeing=!1})});if(this.owner.parent.udpateShuXing(i),2==G.YaoJiScript.buJianNum){this.startGame=!0,G.YaoJiScript.openStartBtnAnim();let e=utils.getChildDeep(this.homeUI,"box_point"),t=utils.transPos(this.homeUI,e);this.homeUI.box_hand.x=-t.x,this.homeUI.box_hand.y=-t.y,this.homeUI.ani2.play(0,!0)}}scaleAnim(e,t,i){0==t?audioManager.playSound(5,null,!1):1==t&&audioManager.playSound(6,null,!1);let a=new Laya.TimeLine;this.timeLineArr.push(a),a.to(e.transform,{localScaleX:t,localScaleY:t,localScaleZ:t},900).play(0,!1),a.on(Laya.Event.COMPLETE,this,()=>{a.pause(),a.destroy(),i&&i()})}initTube(){}initZhen(){c.getIns().getModelById(10007,function(e){this.newScene.addChild(e),this.zhenModel=e,c.getIns().getModelById(40006,t=>{utils.getChildDeep(e,"Dummy001").addChild(t),c.getIns().setLocalPosition(t,.0025,0,0),c.getIns().setLocalScale(t,.01,.01,.01),this.zhenModel.shui1=t,this.zhenModel.shui1.active=!1}),c.getIns().setMaterialPic(utils.getChildDeep(this.zhenModel,"Pistol_Liquid_0"),"res/tex/null.png"),c.getIns().setLocalPosition(e,-1,3.35,3.7)}.bind(this))}showPistol(e){if(G.YaoJiScript.playerAnim)return;G.YaoJiScript.playerAnim=!0;let t=G.YaoJiScript.selectNode.mapData,i=this.zhenModel;"tail"!=t.type2&&"wing"!=t.type2&&"bei"!=t.type2||this.updateHeroAngle(150);let a=new Laya.TimeLine;a.to(i.transform,{localPositionX:-.032},500).play(0,!1),a.on(Laya.Event.COMPLETE,this,()=>{a.pause(),a.reset(),c.getIns().playAnim(i,"rotate1",this,()=>{a.to(i.transform,{localPositionY:3.2},200).play(0,!1),a.on(Laya.Event.COMPLETE,this,()=>{a.pause(),a.reset(),G.YaoJiScript.useYaoJiAnim(),audioManager.playSound(3,null,!1),c.getIns().setMaterialPic(utils.getChildDeep(this.zhenModel,"Pistol_Liquid_0"),t.colorPic),c.getIns().playAnim(i,"get",this,()=>{let e=t.colorRBG;this.zhenModel.shui1._children[0].particleSystem.startColorConstant=new Laya.Vector4(e[0]/255,e[1]/255,e[2]/255,1),this.zhenModel.shui1.active=!0}),a.to(i.transform,{localPositionY:3.15},500).play(0,!1),a.on(Laya.Event.COMPLETE,this,()=>{a.pause(),a.destroy(),c.getIns().playAnim(i,"rotate2",this,()=>{}),(a=new Laya.TimeLine).to(i.transform,{localPositionX:.05,localPositionY:4,localPositionZ:-.5},500).play(0,!1),a.on(Laya.Event.COMPLETE,this,()=>{a.pause(),a.reset(),e&&e(),a.to(i.transform,{localPositionX:.04},300).play(0,!1),a.on(Laya.Event.COMPLETE,this,()=>{a.pause(),a.destroy(),c.getIns().setLocalRotation(i,0,0,0),c.getIns().playAnim(i,"push",this,()=>{c.getIns().playAnim(i,"idle"),c.getIns().setLocalPosition(i,-1,3.35,3.7),G.YaoJiScript.playerAnim=!1,G.YaoJiScript.clickMoveAnim=!1,G.YaoJiScript.isMove=!1,this.zhenModel.shui1.active=!1,c.getIns().setMaterialPic(utils.getChildDeep(this.zhenModel,"Pistol_Liquid_0"),"res/tex/null.png"),this.changePart(t.id,t.type)})})})})})})})}updateHeroAngle(e){let t=new Laya.TimeLine;t.to(this.heroBase.transform,{localRotationEulerY:e},300).play(0,!1),t.on(Laya.Event.COMPLETE,this,()=>{t.pause(),t.destroy()})}endGame(){this.initRole(),this.updateHeroAngle(0)}onUpdate(){G.FRAME_INTERVAL}onDown(e){this.posX=e.stageX}onMove(e){if(this.posX&&this.heroBase){let t=e.stageX-this.posX;this.heroBase.transform.localRotationEulerY>=360?this.heroBase.transform.localRotationEulerY=0:this.heroBase.transform.localRotationEulerY+=t,this.posX=e.stageX}}onUp(e){this.posX=null}onDisable(){}clearTimeLineArr(){for(let e=0;e<this.timeLineArr.length;e++)this.timeLineArr[e]._tweenDic&&(this.timeLineArr[e].pause(),this.timeLineArr[e].destroy());this.timeLineArr=[]}onDestroy(){this.clearTimeLineArr()}clearModel(){}}class p extends Laya.Script{constructor(){super(),G.YaoJiScript=this}onAwake(){this.initData(),this.initEvent()}initData(){this.homeUI=this.owner._scene,this.mouseDir=0,this.moveDis=0,this.playerAnim=!1,this.clickMoveAnim=!1,this.selectNode=null,this.boxWidth=150,this.yaoHuangTime=10,this.chaVal=10,this.step=500,this.yaoJiModelArr=[],this.newID=0,this.buJianNum=0,this.click=1,this.guideCD=5}initEvent(){this.homeUI.box_yaoJi.on(Laya.Event.MOUSE_DOWN,this,this.onDown),this.homeUI.box_yaoJi.on(Laya.Event.MOUSE_MOVE,this,this.onMove),this.homeUI.box_yaoJi.on(Laya.Event.MOUSE_UP,this,this.onUp),this.homeUI.box_yaoJi.on(Laya.Event.MOUSE_OUT,this,this.onUp)}onEnable(){this.newScene=this.owner.addChild(new Laya.Scene3D),this.newScene.ambientColor=new Laya.Vector3(.7,.7,.7);var e=new Laya.DirectionLight;this.newScene.addChild(e),e.color=new Laya.Vector3(1,1,1),e.intensity=.38,e.transform.position=new Laya.Vector3(1.41,10.65,-17.23),e.transform.rotationEuler=new Laya.Vector3(-50,0,0),this.directionLight=e,this.camera=cameraUtils.createCamera(new Laya.Vector3(.007,3.58,4.536),new Laya.Vector3(-17.18,2.9,0)),this.camera.orthographic=!0,this.camera.clearFlag=Laya.BaseCamera.CLEARFLAG_DEPTHONLY,this.camera.orthographicVerticalSize=2,this.newScene.addChild(this.camera),this.initTube(),this.craeteStartBtn()}onUpdate(){let e=G.FRAME_INTERVAL;if(this.guideCD>0&&!G.HomeScript.startGame&&1==dataManager.getPlayerData("level")&&(this.guideCD-=e,this.guideCD<0)){let e=utils.transPos(this.homeUI,this.homeUI.box_yaoJi);this.homeUI.box_hand.x=Laya.stage.width/3,this.homeUI.box_hand.y=50-e.y,this.homeUI.ani2.play(0,!0)}if(this.mouseDir){let t=e*this.step,i=Laya.stage.width/2,a=this.selectNode.x+this.boxWidth/2;if(2==this.mouseDir&&a<=i)return this.mouseDir=0,this.step=500,void this.daYaoJi(this.selectNode.model);if(1==this.mouseDir&&a>=i)return this.mouseDir=0,this.step=500,void this.daYaoJi(this.selectNode.model);a>i-this.boxWidth/2&&a<i+this.boxWidth/2?this.step=100:this.step-=200*e,1==this.mouseDir?this.updateMoveYaoGuan(t):2==this.mouseDir&&this.updateMoveYaoGuan(-t),this.updateYaoGuan()}if(this.yaoHuangTime-=e,this.yaoHuangTime<0){this.yaoHuangTime=5;let e=this.homeUI.box_yaoJi._children;for(let t=0;t<e.length;t++)c.getIns().stopAnim(e[t].model,"water")}}initTube(){this.createBox();let e=this.homeUI.box_yaoJi._children;for(let t=0;t<e.length;t++){let i=e[t];c.getIns().getModelById(10003,function(e){i.model=e,this.yaoJiModelArr.push(e),utils.getChildDeep(e,"Cork").active=!i.isOwn;let t=utils.getChildDeep(i,"box_point"),a=utils.transPos(t,Laya.stage),s=new Laya.Vector3(0,0,0);this.camera.convertScreenCoordToOrthographicCoord(new Laya.Vector3(a.x,a.y,0),s),this.newScene.addChild(e),c.getIns().setLocalPosition(e,s.x,s.y,s.z),c.getIns().setLocalScale(e,1.5,1.5,1.5),c.getIns().stopAnim(e,"water"),c.getIns().setMaterialPic(utils.getChildDeep(e,"biaoqian"),i.mapData.icon),c.getIns().setMaterialPic(utils.getChildDeep(e,"Test_Tube1_0"),i.mapData.colorPic)}.bind(this))}this.homeUI.box_yaoJi.width=e.length*this.boxWidth}createBox(){let e=Object.values(D.AnimalParts),t=[],i=[];for(let a=0;a<e.length;a++)dataManager.queryYaoJi(e[a].id)?i.push(e[a]):t.push(e[a]);e=i.concat(t);for(let t=0;t<e.length;t++){let i=e[t],a=new Laya.Image;this.homeUI.box_yaoJi.addChild(a),a.width=this.boxWidth,a.height=250,a.y=0,a.x=t*this.boxWidth;let s=new Laya.Box;a.addChild(s),s.name="box_point",s.centerX=0,s.centerY=50;let o=new Laya.Image("common/img_field_element1.png");a.addChild(o),o.centerX=25,o.top=-120,o.visible=!1,this.newID==i.id&&(o.visible=!0);let n=new Laya.Image("common/img_video.png");a.addChild(n),n.name="img_video",n.centerX=0,n.centerY=0,n.scaleX=.8,n.scaleY=.8,n.visible=!1,a.mapData=i,a.isOwn=dataManager.queryYaoJi(i.id),a.isUse=!1,a.on(Laya.Event.MOUSE_UP,this,e=>{if(!(this.playerAnim||a.kong||this.buJianNum<2&&!a.isOwn||this.clickMoveAnim||this.isMove)){audioManager.playSound(1,null,!1);let e=()=>{a.isOwn||(utils.getChildDeep(a.model,"Cork").active=!1),this.newID==i.id&&(o.visible=!1,this.newID=0),n.visible&&(n.visible=!1),this.clickMoveAnim=!0,a.isUse=!0,this.selectNode=a;let e=utils.transPos(a,Laya.stage),t=Laya.stage.width/2;t-(e.x+50)>this.chaVal?this.mouseDir=1:t-(e.x+50)<this.chaVal?this.mouseDir=2:t-(e.x+50)<0?this.mouseDir=1:t-(e.x+50)>0?this.mouseDir=2:this.daYaoJi(a.model),this.moveDis=Math.abs(e.x-(Laya.stage.width/2-a.width/2))};this.buJianNum>=2||!a.isOwn?(console.log("看视频"),a.isOwn,window.uleeSDK?(audioManager.setMusicMuted(!1),uleeSDK.showVideoAD(()=>{e(),audioManager.huifuMusicMuted()},()=>{audioManager.huifuMusicMuted()})):e()):e()}})}}craeteStartBtn(){c.getIns().getModelById(10002,e=>{this.newScene.addChild(e),this.startBtn=e;let t=utils.getChildDeep(this.homeUI.box_start,"box_point"),i=utils.transPos(t,Laya.stage),a=new Laya.Vector3(0,0,0);this.camera.convertScreenCoordToOrthographicCoord(new Laya.Vector3(i.x,i.y,0),a),c.getIns().setLocalPosition(e,a.x,a.y,a.z),c.getIns().setLocalRotation(e,0,175,0),c.getIns().setLocalScale(e,.5)})}openStartBtnAnim(){let e=utils.getChildDeep(this.startBtn,"Button_0"),t=utils.getChildDeep(this.startBtn,"Play_Button_Glass"),i=new Laya.TimeLine;i.to(t.transform,{localRotationEulerX:180},300).play(0,!1),i.on(Laya.Event.COMPLETE,this,()=>{i.pause(),i.destroy(),c.getIns().setMaterialPic(e,"res/tex/color_rabbit.jpg")})}showCellVideo(){if(this.buJianNum>=2){let e=this.homeUI.box_yaoJi._children;for(let t=0;t<e.length;t++)e[t].isUse||(utils.getChildDeep(e[t],"img_video").visible=!0)}}updateList(){this.homeUI.box_yaoJi.removeChildren();for(let e=0;e<this.yaoJiModelArr.length;e++)this.yaoJiModelArr[e].destroy();this.yaoJiModelArr=[],this.initTube()}updateYaoGuan(){let e=this.homeUI.box_yaoJi._children;for(let t=0;t<e.length;t++){let i=e[t],a=i.model,s=utils.getChildDeep(i,"box_point"),o=utils.transPos(s,Laya.stage),n=new Laya.Vector3(0,0,0);this.camera.convertScreenCoordToOrthographicCoord(new Laya.Vector3(o.x,o.y,0),n),c.getIns().setLocalPosition(a,n.x,n.y,n.z),i.isUse||c.getIns().playAnim(a,"water")}this.yaoHuangTime=5}updateMoveYaoGuan(e){let t=this.homeUI.box_yaoJi._children;for(let i=0;i<t.length;i++){t[i].x+=e;let a=utils.transPos(t[i],Laya.stage);if(e>0){if(a.x>(t.length-1)*this.boxWidth){let e=t[i];return e.x=t[0].x-this.boxWidth,t.splice(t.length-1,1),void t.unshift(e)}}else if(e<0&&a.x<-this.boxWidth){let e=t[i];return e.x=t[t.length-1].x+this.boxWidth,t.push(e),void t.splice(0,1)}}}daYaoJi(e){this.buJianNum++;let t=e.transform.localPositionZ,i=new Laya.TimeLine;i.to(e.transform,{localPositionZ:e.transform.localPositionZ-.1},200).play(0,!1),i.on(Laya.Event.COMPLETE,this,()=>{i.pause(),i.reset(),G.HomeScript.updateHeroAngle(0),G.HomeScript.showPistol(()=>{let i=new Laya.TimeLine;i.to(e.transform,{localPositionZ:t},200).play(0,!1),i.on(Laya.Event.COMPLETE,this,()=>{i.pause(),i.destroy(),this.showCellVideo()})})})}useYaoJiAnim(){this.selectNode.kong=!0;let e=this.selectNode.model,t=this.selectNode.mapData.colorRBG;c.getIns().playAnim(e,"fall"),c.getIns().getModelById(40007,e=>{this.newScene.addChild(e),e._children[0].particleSystem.startColorConstant=new Laya.Vector4(t[0]/255,t[1]/255,t[2]/255,1),c.getIns().setLocalPosition(e,this.selectNode.model.transform.localPositionX,this.selectNode.model.transform.localPositionY,this.selectNode.model.transform.localPositionZ)})}getYaoJi(){let e=this.homeUI.box_yaoJi._children,t=[];for(let i=0;i<e.length;i++)e[i].isUse&&t.push(e[i].mapData.id);return t}endGame(){this.buJianNum=0,this.updateList(),this.homeUI.updateListHeight()}onDown(e){this.playerAnim||this.clickMoveAnim||(this.posX=e.stageX,this.isMove=!1)}onMove(e){if(!this.playerAnim&&!this.clickMoveAnim&&this.posX&&0==this.mouseDir&&(Math.abs(e.stageX-this.posX)>10||this.isMove)){this.isMove=!0;let t=e.stageX-this.posX;this.updateMoveYaoGuan(t),this.updateYaoGuan(),this.posX=e.stageX}}onUp(e){this.posX=null}onDisable(){}}class f extends e{constructor(){super(),this.loadItems=[],this.currItem=null,this.value=0,this.count=0,this.currCount=0,this.countMax=0}initUI(){super.initUI.call(this),this.updateKey=updateManager.frameLoop(1,this,this.update)}addItem(e){this.countMax+=e.count,this.loadItems.push(e),e.loading=this}updateProgress(){this.value=this.count/this.countMax,this.value>=1&&this.onLoaded()}update(){if(null==this.currItem)if(0==this.loadItems.length){if(this.count>=this.countMax)return}else this.count>=this.currCount&&(this.currItem=this.loadItems.shift(),this.currItem.start());else this.currItem.loaded?(this.currCount+=this.currItem.count,this.currItem=null):this.currItem.checkFn&&this.currItem.checkFn();this.count<this.currCount&&this.count++,this.updateProgress()}onLoaded(){updateManager.clear(this.updateKey,this)}}class y extends f{constructor(){super(),this.autoDestroyAtClosed=!0,uiManager.openUI("gameView/YSView.scene")}initUI(){super.initUI.call(this),this.panel_loading.width=.1,window.uleeSDK&&("oppo"!=uleeSDK.pf&&"vivo"!=uleeSDK.pf||dataManager.getPlayerData("YSOK")||uiManager.openUI("gameView/SignView.scene")),window.tt?(this.addItem(new ulee.LoadItem(function(){let e=this;tt.loadSubpackage({name:"ad",success:function(t){e.onComplete()},fail:function(e){console.log("加载失败",e)}})},10)),this.addItem(new ulee.LoadItem(function(){let e=this;tt.loadSubpackage({name:"tex",success:function(t){e.onComplete()},fail:function(e){console.log("加载失败",e)}})},10)),this.addItem(new ulee.LoadItem(function(){let e=this;tt.loadSubpackage({name:"first3D",success:function(t){e.onComplete()},fail:function(e){console.log("加载失败",e)}})},10)),this.addItem(new ulee.LoadItem(function(){tt.loadSubpackage({name:"effect",success:function(e){},fail:function(e){console.log("加载失败",e)}}),this.onComplete()},10)),this.addItem(new ulee.LoadItem(function(){tt.loadSubpackage({name:"music",success:function(e){audioManager.playMusic(11)},fail:function(e){console.log("加载失败",e)}}),this.onComplete()},10)),this.addItem(new ulee.LoadItem(function(){tt.loadSubpackage({name:"sound",success:function(e){audioManager.playMusic(11)},fail:function(e){console.log("加载失败",e)}}),this.onComplete()},10)),this.addItem(new ulee.LoadItem(function(){tt.loadSubpackage({name:"model",success:function(e){},fail:function(e){console.log("加载失败",e)}}),this.onComplete()},10)),this.addItem(new ulee.LoadItem(function(){tt.loadSubpackage({name:"level",success:function(e){},fail:function(e){console.log("加载失败",e)}}),this.onComplete()},10))):Laya.Browser.onVVMiniGame?this.addItem(new ulee.LoadItem(function(){let e=this;qg.loadSubpackage({name:"model",success:function(t){e.onComplete()},fail:function(e){console.log("加载失败",e)}})},10)):Laya.Browser.onQGMiniGame,this.addItem(new ulee.LoadItem(function(){uiManager.openUI("gameView/HomeView.scene",null,{callback:()=>{this.onComplete()}})},10)),this.addItem(new ulee.LoadItem(function(){this.onComplete()},10))}updateProgress(){super.updateProgress.call(this),this.panel_loading&&!this.panel_loading.destroyed&&(this.panel_loading.width=this.value/1*560)}onLoaded(){super.onLoaded.call(this),this.panel_loading.width=560,Laya.timer.once(150,this,function(){G.LOADMUSIC=!0,G.ISSOUND=!0,audioManager.playMusic(11);let e=uiManager.getUI("gameView/HomeView.scene");uiManager.openUI("gameView/TlView.scene",e),uiManager.getUI("gameView/HomeView.scene").visible=!0,this.doClose()})}}class L extends e{constructor(){super()}initUI(){}initData(){}initEvent(){utils.onBtnEvent(this.btn_login,this,this.login)}login(e){uiManager.openUI("gameView/LoadingView.scene"),this.doClose()}}class M extends e{constructor(){super(),window.uleeSDK&&uleeSDK.stopGameRecorder()}initData(){}initUI(){}initEvent(){utils.onBtnScaleEvent(this.btn_close,this,this.doClose),utils.onBtnScaleEvent(this.btn_share,this,()=>{window.uleeSDK?uleeSDK.shareGameRecorder(()=>{this.doClose()}):this.doClose()})}doClose(){this.argObj&&this.argObj.callback&&this.argObj.callback(),super.doClose()}}class w extends e{constructor(){super()}initData(){}initUI(){}initEvent(){utils.onBtnScaleEvent(this.btn_no,this,()=>{window.uleeSDK&&("oppo"==uleeSDK.pf?qg.exitApplication({}):"vivo"==uleeSDK.pf&&qg.exitApplication()),this.doClose()}),utils.onBtnScaleEvent(this.btn_ok,this,()=>{dataManager.setPlayerData("YSOK",!0),this.doClose()}),utils.onBtnEvent(this.btn_ys,this,()=>{uiManager.getUI("gameView/YSView.scene").openView()})}doClose(){super.doClose()}}class C extends e{constructor(){super()}initData(){G.TLUI=this}initUI(){this.box_xy.visible=!1,this.box_add.visible=!1,this.btn_xy.visible=!dataManager.getPlayerData("WUXIAN"),this.ani1.play(0,!0),this.updateTl(),this.check()}initEvent(){utils.onBtnScaleEvent(utils.getChildDeep(this.box_add,"btn_ad"),this,()=>{var e=()=>{dataManager.setPlayerData("TL",dataManager.getPlayerData("TL")+10),utils.prompt("HP + 10"),this.box_add.visible=!1,this.updateTl()};uleeSDK?(audioManager.setMusicMuted(!1),uleeSDK.showVideoAD(()=>{e(),audioManager.huifuMusicMuted()},()=>{audioManager.huifuMusicMuted()})):e()}),utils.onBtnScaleEvent(utils.getChildDeep(this.box_add,"btn_get"),this,()=>{dataManager.setPlayerData("TL",dataManager.getPlayerData("TL")+5),utils.prompt("HP + 5"),this.box_add.visible=!1,this.updateTl()}),utils.onBtnScaleEvent(this.btn_xy,this,()=>{dataManager.getPlayerData("WUXIAN")?utils.prompt("Infinite HP Today"):this.initXY()}),utils.onBtnScaleEvent(utils.getChildDeep(this.box_xy,"btn_close"),this,()=>{this.box_xy.visible=!1}),utils.onBtnScaleEvent(utils.getChildDeep(this.box_xy,"btn_ad"),this,()=>{let e=()=>{dataManager.setPlayerData("LOOK",dataManager.getPlayerData("LOOK")+1),dataManager.getPlayerData("LOOK")>=1&&dataManager.setPlayerData("WUXIAN",!0),this.initXY(),this.doClose(),utils.prompt("Congratulations On Getting Infinite HP Today"),this.btn_xy.visible=!dataManager.getPlayerData("WUXIAN")};uleeSDK?(audioManager.setMusicMuted(!1),uleeSDK.showVideoAD(()=>{e(),audioManager.huifuMusicMuted()},()=>{audioManager.huifuMusicMuted()})):e()})}updateTl(){let e=utils.getChildDeep(this.box_info,"coin"),t=utils.getChildDeep(this.box_info,"tl");utils.getChildDeep(e,"num").text=dataManager.getPlayerData("COIN"),utils.getChildDeep(t,"num").text=dataManager.getPlayerData("TL")}initXY(){utils.getChildDeep(this.box_xy,"txt").text="Watched ("+dataManager.getPlayerData("LOOK")+" / 1)",this.box_xy.visible=!0}check(){dataManager.getPlayerData("TL")<5&&(this.box_add.visible=!0)}doClose(){G.TLUI=null,super.doClose()}}class I extends e{constructor(){super(),this.visible=!1}initData(){}initUI(){this.panel_m.visible=!1,this.label_date.visible=!1,this.panel_m._vScrollBar.visible=!1}initEvent(){utils.onBtnScaleEvent(this.btn_close,this,()=>{this.label_awit.visible=!0,this.panel_m.visible=!1,this.label_date.visible=!1,this.visible=!1})}openView(){this.visible=!0,this.panel_m.scrollTo(0,0),this.label_awit.visible=!0,Laya.timer.once(500,this,()=>{this.label_awit.visible=!1,this.panel_m.visible=!0,this.label_date.visible=!0})}doClose(){super.doClose()}}class S{static init(){let e=Laya.ClassUtils.regClass;e("ui/BattleUI.js",o),e("ui/BoxUI.js",n),e("ui/ChangeUI.js",l),e("ui/ClickUI.js",r),e("ui/GameOverUI.js",h),e("ui/HomeUI.js",d),e("script/HomeScript.js",g),e("script/YaoJiScript.js",p),e("ui/GameLoading.js",y),e("ui/LoginUI.js",L),e("ui/ShareADUI.js",M),e("ui/SignUI.js",w),e("ui/TlUI.js",C),e("ui/YSUI.js",I)}}S.width=720,S.height=1559,S.scaleMode="showall",S.screenMode="none",S.alignV="top",S.alignH="left",S.startScene="gameView/LoadingView.scene",S.sceneRoot="",S.debug=!1,S.stat=!1,S.physicsDebug=!1,S.exportSceneToJson=!0,S.init(),window.ulee={},ulee.io={},window.G={},window.D={},window.Vector3=Laya.Vector3,window.Pool=Laya.Pool,window.Handler=Laya.Handler,G.ENUM_LOOP_TYPE={FRAME:0,TIME:1},G.FRAME_INTERVAL=0,G.NOW=Laya.Browser.now(),G.DELAYTIME=null,G.ADGUSTTIME=null,G.SERVER_FRAMETIME=null,Math.RAD_1_ANGLE=Math.PI/180,Math.ANGLE_1_RAD=180/Math.PI,G.SCREEN_MODETYPE={H:0,V:1},G.SCREEN_MODE=G.SCREEN_MODETYPE.V,G.MAXLEVEL=130,G.WX=Laya.Browser.onMiniGame,G.RANKDATA=[],G.CELL_STATE={IDLE:0,MOVE:1,SELECT:2,DIE:3},G.DISPEL_TYPE={NORMAL:0,AREA:1,V:2,H:3,SUPER:4},G.aniConfPath={effect_dispel:"res/atlas/effect/destroy_effect.atlas",effect_arrow:"res/atlas/effect/line_effect.atlas",effect_star:"res/atlas/effect/effect_star.atlas",effect_hole:"res/atlas/effect/effect_hole.atlas"},G.ROLE_STATE={RUN:0,CLIMB:1,SWIM:2,PUNCH:3,FLY:4},G.ROAD_TYPE={ROAD:0,POOL:1,BELT:2},G.CELLMOVETIME=.13,G.TIPTIME=3,G.MOVE_FEE_COIN=100,G.IN_GAME_CAO_NUM=1,G.MAX_HUO_YUE_DU=120,G.TURNTABLES_MAX_NUM=5,G.TURNTABLES_REWARD_NUM=50,G.MAXLEVEL=15,G.BANNER_IMG=["ad/img_1.jpg","ad/img_2.jpg","ad/img_3.jpg","ad/img_4.jpg"],G.totalShowADTime=0,G.removeAt=function(e,t){var i=e[t];return e.splice(t,1),i},G.remove=function(e,t){for(var i=e.length-1;i>=0;i--)if(e[i]==t)return void e.splice(i,1)},G.contains=function(e,t){return-1!=e.indexOf(t)},G.clone=function(e){if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return t.setTime(e.getTime()),t;if(e instanceof Array){for(var t=[],i=0;i<e.length;++i)t[i]=G.clone(e[i]);return t}if(e instanceof Object){for(var a in t={},e)e.hasOwnProperty(a)&&(t[a]=G.clone(e[a]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};for(var i in/(y+)/i.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e},String.prototype.startWith=function(e){var t="^"+e,i=Pool.getItem(t,RegExp);null==i&&(i=new RegExp(t));var a=i.test(this);return Pool.recover(t,i),a},String.prototype.endWith=function(e){var t=e+"$",i=Pool.getItem(t,RegExp);null==i&&(i=new RegExp(t));var a=i.test(this);return Pool.recover(t,i),a},String.prototype.replaceAll=function(e,t){return this.split(e).join(t)},G.copyProperties=function(e,t){for(var i in e)t[i]=e[i]},G.getLength=function(e){var t=0;for(var i in e)t++;return t},ulee.Event={},ulee.Event.ON_DATA_LOAD=1e3,ulee.Event.UPDATE_GOLD=1001,function(){ulee.LoadItem=function(e,t,i){this.loaded=!1,this.loadFn=e,this.count=t,this.checkFn=i,this.loading=null},(0,Laya.ClassUtils.regClass)(ulee.LoadItem,"ulee.LoadItem");var e=ulee.LoadItem.prototype;e.onComplete=function(){this.loaded=!0},e.start=function(){this.loadFn()}}(),function(){ulee.PromptUtils=function(){},(0,Laya.ClassUtils.regClass)(ulee.PromptUtils,"ulee.PromptUtils");var e=ulee.PromptUtils.prototype;e.init=function(){this.bgSprite=new Laya.Image("common/img_infoBase.png"),this.bgSprite.width=Laya.stage.width-40,this.bgSprite.height=50,this.bgSprite.anchorX=.5,this.bgSprite.anchorY=.5,this.bgSprite.x=Laya.stage.width/2,this.bgSprite.y=Laya.stage.height/9,this.textOffx=30,this.textOffy=15,this.tipText=new Laya.Label,this.bgSprite.addChild(this.tipText),this.tipText.width=this.bgSprite.width-2*this.textOffx,this.tipText.fontSize=30,this.tipText.align="center",this.tipText.color="#ffffff",this.tipText.y=this.textOffy,this.bgSprite.zOrder=2e3,Laya.stage.addChild(this.bgSprite),this.timeLine=new Laya.TimeLine,this.timeLine.addLabel("scale",0).to(this.bgSprite,{scaleX:1.2,scaleY:1.2,alpha:1},100,null,0).addLabel("back",0).to(this.bgSprite,{scaleX:1,scaleY:1,alpha:1},100,null,0).addLabel("show",0).to(this.bgSprite,{alpha:1},1e3,null,0).addLabel("hide",0).to(this.bgSprite,{alpha:0},1e3,null,0),this.timeLine.on(Laya.Event.COMPLETE,this,this.onComplete),this.mouseThrough=!0},e.removeRes=function(){this.timeLine.destroy()},e.onComplete=function(){this.visible=!1,this.mouseThrough=!0},e.prompt=function(e){this.tipText.text=e,this.tipText.x=this.textOffx,this.bgSprite.height=30+this.textOffx,this.timeLine.play(0,!1),this.visible=!0},e.prompt1=function(e){this.bgSprite.skin=e,this.bgSprite.height=null,this.bgSprite.width=null,this.timeLine.play(0,!1),this.visible=!0},e.resize=function(){this.bgSprite&&(this.bgSprite.width=Laya.stage.width-40,this.bgSprite.height=this.tipText.contextHeight+this.textOffx,this.bgSprite.x=Laya.stage.width/2,this.bgSprite.y=Laya.stage.height/8,this.tipText&&(this.tipText.style.width=this.bgSprite.width-2*this.textOffx))}}(),window.promptUtils=new ulee.PromptUtils,function(){ulee.io.DataInputStream=function(e){this.arrayBuffer=e,this.index=0,this.dv=new DataView(this.arrayBuffer)},(0,Laya.ClassUtils.regClass)(ulee.io.DataInputStream,"ulee.io.DataInputStream");var e=ulee.io.DataInputStream.prototype;e.readByte=function(){return this.dv.getInt8(this.index++)},e.readShort=function(){var e=this.dv.getInt16(this.index);return this.index+=2,e},e.readInt=function(){var e=this.dv.getInt32(this.index);return this.index+=4,e},e.readUint=function(){var e=this.dv.getUint32(this.index);return this.index+=4,e},e.readLong=function(){var e=this.readInt(),t=this.readUint();return e*Math.POW_2_32+t},e.readFloat=function(){var e=this.dv.getFloat32(this.index);return this.index+=4,e},e.readUTF=function(){var e=this.readShort();return this.readText(e)},e.readText=function(e){for(var t=this.arrayBuffer.slice(this.index,this.index+e),i=new Uint8Array(t),a="",s=e,o=0,n=String.fromCharCode,l=0,r=i;l<s;)(o=r[l++])<128?0!=o&&(a+=n(o)):a+=n(o<224?(63&o)<<6|127&r[l++]:o<240?(31&o)<<12|(127&r[l++])<<6|127&r[l++]:(15&o)<<18|(127&r[l++])<<12|r[l++]<<6&127|127&r[l++]),0;return this.index+=e,a},e.readArrayBuffer=function(e){var t=this.arrayBuffer.slice(this.index,this.index+e);return this.index+=e,t}}(),window.initData=function(){Laya.loader.load("js/data.bin",Laya.Handler.create(this,function(e){for(var t,i,a,s,o,n,l,r={},h=Laya.Loader.getRes("js/data.bin"),d=new ulee.io.DataInputStream(h),c=d.readUTF(),u=[],m=[];"#"!=c;){o=r[c]={},t=d.readByte(),u.length=0,m.length=0;for(var g=0;g<t;g++)u.push(d.readUTF()),m.push(d.readUTF());i=d.readShort();for(var p=0;p<i;p++)for(var f=0;f<t;f++){switch(m[f]){case"byte":a=d.readByte();break;case"short":a=d.readShort();break;case"int":a=d.readInt();break;case"float":a=d.readFloat();break;case"string":a=d.readUTF();break;case"int[]":if(a=void 0,(n=d.readShort())>0)for(a=[],l=0;l<n;l++)a.push(d.readInt());break;case"float[]":if(a=void 0,(n=d.readShort())>0)for(a=[],l=0;l<n;l++)a.push(d.readFloat());break;default:console.error("DataInputStream缺失解析方法："+m[f])}0==f&&(s=o[a]={}),s[u[f]]=a}c=d.readUTF()}D=r,Laya.Loader.clearRes("js/data.bin",!0),function(){var e;for(var t in D.ScreenShow){var i=D.ScreenShow[t];1==t&&(e=i.screenPixel),e>10&&(i.screenPixel/=e)}}(),function(){for(var e in D.musicBasic){var t=D.musicBasic[e];t.musicPower*=.01}}(),function(){var e=[];for(var t in D.PrefabsPath){var i=D.PrefabsPath[t];i.subModel?i.subModel=i.subModel.split("#"):i.subModel=e,i.actionInShop?i.actionInShop=i.actionInShop.split("#"):i.actionInShop=e}}(),"undefined"!=typeof addModelConfig&&(addModelConfig(),function(){function addHead(e,t){if(e)for(var i=0,a=e.length;i<a;i++)e[i]=t+e[i]}var e;for(var t in D.ModelConfig)addHead((e=D.ModelConfig[t]).resource,t),addHead(e.zipResource,t)}()),D._inited=!0,eventDispatcher.dispatchEvent(ulee.Event.ON_DATA_LOAD)}),null,Laya.Loader.BUFFER)},function(){ulee.Utils=function(){this._pool=Laya.Pool},(0,Laya.ClassUtils.regClass)(ulee.Utils,"ulee.Utils");var e=ulee.Utils.prototype;e.getColor=function(e){return this.colorConfig[e]},e.onBtnEvent=function(e,t,i){null==e&&console.log("控件不存在"),e.offAll(),e.on(Laya.Event.MOUSE_DOWN,t,function(e){e.stopPropagation()}),e.on(Laya.Event.ROLL_OUT,t,function(e){e.stopPropagation()}),e.on(Laya.Event.MOUSE_UP,t,function(e){e.stopPropagation()}),e.on(Laya.Event.CLICK,t,function(e){null!=i&&i.bind(t)(e),null!=e.stopPropagation&&e.stopPropagation()})},e.offBtnEvent=function(e,t,i){null==e&&console.log("控件不存在"),e.off(Event.CLICK,t,i)},e.onBtnScaleEvent=function(e,t,i,a){null==e&&console.log("控件不存在");var s=e.scaleX?e.scaleX:1,o=e.scaleY?e.scaleY:1;e.offAll(),e.anchorX=isNaN(e.anchorX)?0:e.anchorX,e.anchorY=isNaN(e.anchorY)?0:e.anchorY;var n=e.x+(.5*e.width-e.width*e.anchorX),l=e.y+(.5*e.height-e.height*e.anchorY);e.anchorX=.5,e.anchorY=.5,e.x=n,e.y=l,e.on(Laya.Event.MOUSE_DOWN,t,function(e){e.target.scale(.9*s,.9*o),!a&&e.stopPropagation()}),e.on(Laya.Event.ROLL_OUT,t,function(e){e.currentTarget.scale(s,o),!a&&e.stopPropagation()}),e.on(Laya.Event.MOUSE_UP,t,function(e){e.target.scale(s,o),!a&&e.stopPropagation()}),e.on(Laya.Event.CLICK,t,function(e){null!=i&&i.bind(t)(e),null!=e.stopPropagation&&!a&&e.stopPropagation()})},e.getString=function(t,i){if(!D.GameText[t])return t+i;var a=D.GameText[t].chs;return a?i?e.stringFormat(a,i):a:""},e.getLength=function(e){return e.replace(/[\u0391-\uFFE5]/g,"aa").length},e.stringFormat=function(e,t){if(!e)return t;var i=e;if(t)for(var a=0;a<t.length;a++)i=i.replaceAll("{"+a+"}",t[a]);return i},e.setImgBlur=function(e,t){if(e){t=t||5;var i=new Laya.BlurFilter;i.strength=t,e.filters=[i]}},e.setImgGlow=function(e,t,i){if(e){i=i||10,t="#ffff00";var a=new Laya.GlowFilter(t,i,0,0);e.filters=[a]}},e.setImgColor=function(e,t){var i=new Laya.ColorFilter(t);e.filters=[i]},e.clearFilters=function(e){e.filters=[]},e.getChildDeep=function(e,t){var i=e.getChildByName(t);if(i)return i;for(var a=0;a<e._children.length;a++)if(i=utils.getChildDeep(e._children[a],t))return i},e.listSelectEx=function(e){Laya.getset(0,e,"selectedIndex",function(){return this._selectedIndex},function(e){this._selectedIndex!=e&&(this._selectedIndex=e,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith([e,this.getCell(e),this]),this.startIndex=this._startIndex)})},e.setHtmlLabel=function(e,t,i){i||(e.style.fontSize=24,e.style.font="黑体",e.style.color="#ffffff",e.style.align="center"),e.innerHTML=utils.getString(t)},e.setResUsed=function(e){for(var t=0;t<e.length;t++)G.addResCount("img",e[t].url)},e.setResUnused=function(e){for(var t=0;t<e.length;t++)G.delResCount(e[t].url)},e.getTimeLine=function(e){var t=this,i=this._pool.getItemByClass("TimeLine",Laya.TimeLine);i.reset();var a=function(){i.off(Laya.Event.COMPLETE,this,a),t._pool.recover("TimeLine",i),e&&e()};return i.on(Laya.Event.COMPLETE,this,a),i},e.transPos=function(e,t){var i=new Laya.Point;return e.localToGlobal(i),t.globalToLocal(i,!0)},e.prompt=function(e){e&&(this.m_systemPrompt||(this.m_systemPrompt=window.promptUtils,this.m_systemPrompt.init()),this.m_systemPrompt.prompt(e))},e.movePrompt=function(e){},e.promptImg=function(e){e&&(this.m_systemPrompt||(this.m_systemPrompt=uiManager.openUI(ulee.Prompt)),this.m_systemPrompt.prompt1(e))},e.sendParamHttp=function(e,t,i){var a=new Laya.HttpRequest;a._loadedSize=0,a._totalSize=5e6,a.once(Laya.Event.COMPLETE,this,this.onHttpCompelete,[a,i]);for(key in t)e+=this.stringFormat("&{0}={1}",[key,t[key]]);a.send(e,null,"get","text")},e.onHttpCompelete=function(e,t){t&&t.runWith(e.data)},e.formatTime=function(e,t){var i=Math.floor(e/60);if(e%=60,!t||i<60)return utils.timeNumberFormat(i)+":"+utils.timeNumberFormat(e);var a=Math.floor(i/60);return i%=60,a+":"+utils.timeNumberFormat(i)+":"+utils.timeNumberFormat(e)},e.timeNumberFormat=function(e){return(e<10?"0":"")+parseInt(e)},e.updateCircleHead=function(e){var t=new Laya.Sprite;t.graphics.drawCircle(e.width/2,e.width/2,e.width/2,"#ffff00"),t.pos(0,0),e.mask=t},e.listSelectEx=function(e){Laya.getset(0,e,"selectedIndex",function(){return this._selectedIndex},function(e){this._selectedIndex!=e&&(this._selectedIndex=e,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith([e,this.getCell(e),this]),this.startIndex=this._startIndex)})},e.listHandler=function(e,t,i,a){e&&(i&&(e.renderHandler=new Handler(t,i.bind(t))),a&&(e.selectHandler=new Handler(t,a.bind(t))),e.selectEnable=!0)},e.cutstr=function(e,t){for(var i="",a=0;a<e.length;a++)if(i+=e[a],a+1==t){i+="...";break}return i},e.setVector3=function(e,t,i,a){e.x=t,e.y=i,e.z=a},e.getImgUrl=function(e){if(e){try{imgUrl=D.SpritePath[e].chs}catch(t){console.error("找不到图片资源,id:"+e+"/使用临时资源替换"),imgUrl=D.SpritePath[100].chs}return imgUrl}},e.rayCast=function(e,t,i){for(var a=new Laya.RaycastHit,s=0,o=t.length;s<o;s++){var n=t[s];if(n.enable&&(n.raycast(e,a,i),-1!==a.distance))return!0}},e.getYearWeek=function(e,t,i){var a=new Date(e,parseInt(t)-1,i),s=new Date(e,0,1),o=Math.round((a.valueOf()-s.valueOf())/864e5);return Math.ceil((o+(s.getDay()+1-1))/7)},e.gameCoinAnimation=function(e,t,i,a,s,o){this.timeLineArr=[];var n=5;1==t?(n=e)>25&&(n=25):e>1e6?n=30:e>1e5?n=20:e>1e4&&(n=10);var l=new Laya.FontClip("fnt/number1.png","1234567890");l.x=i.x+50,l.y=i.y+18,l.alpha=0,l.value=e,l.scale(0,0),l.anchorX=.5,l.anchorY=.5,s.addChild(l);var r=new Laya.TimeLine;r.name="moneyAni",this.timeLineArr.push(r),r.to(l,{scaleX:.4,scaleY:.4,alpha:1},300).to(l,{scaleX:.2,scaleY:.2,alpha:0},400,null,600),r.on(Laya.Event.COMPLETE,this,function(){o&&o(),l.destroy()});for(var h=!1,d=0;d<n;d++)this.createCoin(t,a,s,function(e){var t=new Laya.TimeLine;this.timeLineArr.push(t),t.to(e,{x:i.x,y:i.y},this.random(100,400),Laya.Ease.backIn,0),d==n&&t.play(-300,!1),t.on(Laya.Event.COMPLETE,this,function(){e.removeSelf(),h||(h=!0,r.play(0,!1))})}.bind(this))},e.createCoin=function(e,t,i,a){var s=new Laya.Image;1==e?s.skin="common/img_diamond.png":2==e&&(s.skin="common/img_coin.png"),s.x=t.x,s.y=t.y,s.scale(0,0),i.addChild(s);var o=new Laya.TimeLine;o.name="coin",this.timeLineArr.push(o);var n=s.x+this.random(0,230),l=s.y+this.random(-100,100);o.addLabel("move",0).to(s,{scaleX:.8,scaleY:.8,x:n,y:l},100,Laya.Ease.backOut,0).play(100,!1),o.on(Laya.Event.COMPLETE,this,function(){a&&a(s)})},e.clearGameCoinAnimation=function(){if(!(null==this.timeLineArr||this.timeLineArr.length<=0))for(var e=0;e<this.timeLineArr.length;e++){var t=this.timeLineArr[e];t.name="",t.pause(),t.destroy(),t=null}},e.checkPrompt=function(){!G.ISSHOWSIGN&&dataManager.getUserData("isCanSign")?(G.ISSHOWSIGN=!0,updateManager.timeOnce(.5,this,function(){uiManager.openUI("game/SignInUI.scene")})):!G.ISTURNTABLE&&dataManager.getUserData("turntableFreeTimes")>0&&(G.ISTURNTABLE=!0,updateManager.timeOnce(.5,this,function(){uiManager.openUI("game/LuckyTurntableView.scene")}))},e.create3DFont=function(e,t,i){var a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createPlane(1,1));a.transform.rotate(new Laya.Vector3(90,0,0),!0,!0),a.transform.localPosition=new Laya.Vector3(0,1.05,0),e.addChild(a);var s=new Laya.UnlitMaterial;a.meshRenderer.sharedMaterial=s;var o=Laya.Browser.createElement("canvas");o.width=200,o.height=200;var n=o.getContext("2d"),l=new Image;l.src="models/obj/obj_texture/img_bubble.png";var r=this;return l.onload=function(){n.drawImage(l,0,0,200,120),n.fillStyle=i||"rgb(255，255，255)",n.font="bold 35px 微软雅黑",n.textAlign="left",n.textBaseline="middle",r.drawText(n,t,15,5,150);var e=new Laya.Texture2D(120,75);e.loadImageSource(o),s.renderMode=Laya.UnlitMaterial.RENDERMODE_TRANSPARENT,s.albedoTexture=e,a.meshRenderer.sharedMaterial.cull=Laya.RenderState.CULL_NONE},a},e.randomSlogan=function(){for(;;){var e=this.random(1,10);if((!this.oldArr||null==this.oldArr||Object.keys(this.oldArr).length>=Object.keys(this.sloganMap).length)&&(this.sloganMap=D.sloganConfig,this.oldArr={}),null==this.oldArr[this.sloganMap[e].id])return this.oldArr[this.sloganMap[e].id]=this.sloganMap[e],this.sloganMap[e].content}},e.crateView=function(e,t,i){i||console.error("未传回调函数"),Laya.loader.create(e,Laya.Handler.create(this,function(e){let a=new Laya.View;a.createView(e),i.bind(t)(a)}))},e.random=function(e,t){return Math.floor(Math.random()*(t+1-e)+e)},e.setSlotSkin=function(e,t,i){Laya.loader.load([i],Laya.Handler.create(this,function(){var a=Laya.loader.getRes(i);e.setSlotSkin(t,a)}))},e.changeDBSkin=function(e,t){let i=e._boneSlotDic;for(let a in i){let s=i[a].srcDisplayIndex;e.replaceSlotSkinByIndex(a,s,t)}},e.formatSeconds=function(e){var t=parseInt(e),i=0,a=0;t>60&&(i=parseInt(t/60),t=parseInt(t%60),i>60&&(a=parseInt(i/60),i=parseInt(i%60)));var s=""+(1==parseInt(t).toString().length?"0"+parseInt(t):parseInt(t));return s=i>0?(1==parseInt(i).toString().length?"0"+parseInt(i):parseInt(i))+":"+s:"00:"+s,a>0&&(s=(1==parseInt(a).toString().length?"0"+parseInt(a):parseInt(a))+":"+s),s}}(),window.utils=new ulee.Utils,function(e){ulee.EventDispatcher=function(){this.eventDispatcher=new Laya.EventDispatcher},(0,Laya.ClassUtils.regClass)(ulee.EventDispatcher,"ulee.EventDispatcher",void 0);var t=ulee.EventDispatcher.prototype;t.addEventListen=function(e,t,i){this.eventDispatcher.on(e,t,i)},t.removeEventListen=function(e,t,i){this.eventDispatcher.off(e,t,i)},t.dispatchEvent=function(e,t){var i={msg:t,name:e};this.eventDispatcher.event(e,i),i=null}}(),window.eventDispatcher=new ulee.EventDispatcher,function(e){ulee.UIManager=function(){this.scene=Laya.Scene,this._dialogList={},this._childList={}},(0,Laya.ClassUtils.regClass)(ulee.UIManager,"ulee.UIManager",void 0);var t=ulee.UIManager.prototype;t.openUI=function(e,t,i,a){if(t){var s=t.url;this._childList[s]||(this._childList[s]=[]),this._childList[s].push(e),Laya.loader.create(e,Laya.Handler.create(this,function(s){if(!s)return;var o=s.props.runtime?s.props.runtime:s.type;let n=new(Laya.ClassUtils.getClass(o));n.url=e,n.createView(s),n.onOpened(i),t.addChild(n),a&&a.run()}))}else Laya.Scene.open(e,!1,i,a)},t.openDialog=function(e,t,i,a){if(t){var s=t.url;this._dialogList[s]||(this._dialogList[s]=[]),this._dialogList[s].push(e),Laya.loader.create(sceneUrl,Laya.Handler.create(this,function(e){let i=new Laya.View;i.createView(e),t.addChild(i),a&&a()}))}else Laya.Scene.open(e,!1,i,a)},t.closeDialog=function(e){for(var t=Laya.stage._children[1]._children,i=0;i<t.length;i++)if(t[i].url==e){t[i].close();break}},t.closeUI=function(e,t){var i=this.getUI(e,t);if(i){var a=i.url;if(this._dialogList[a])for(var s=this._dialogList[a],o=0;o<s.length;o++)this.closeDialog(s[o]);if(this._dialogList[a]=null,this._childList[a])for(s=this._childList[a],o=0;o<s.length;o++)this.closeUI(s[o]);this._childList[a]=null,i.close()}},t.getUI=function(e,t){if(this._uiList=t?t._children:Laya.stage._children[0]._children,!this._uiList)return void console.error("未从uimanager打开任何场景");let i=null;for(let t=0;t<this._uiList.length;t++)if((i=this._uiList[t]).destroyed)this._uiList.removeAt(t),t--;else if(i.url==e)return i;return null}}(),window.uiManager=new ulee.UIManager,function(){ulee.DataManager=function(){this._data={},this.init()},(0,Laya.ClassUtils.regClass)(ulee.DataManager,"ulee.DataManager");var e=ulee.DataManager.prototype;e.init=function(){this._localData=Laya.LocalStorage,this._userData={}},e.initData=function(){this.dataName="GameData",this.getStorage(function(e){m.getIns().copy(e),this.compareTime(this.getPlayerData("inGameTime"))&&(dataManager.setPlayerData("LOOK",0),dataManager.setPlayerData("WUXIAN",!1),this.setPlayerData("inGameTime",(new Date).getTime()))}.bind(this))},e.compareTime=function(e,t){if(t)t=t.getTime();else{var i=new Date;t=new Date(i.getFullYear(),i.getMonth(),i.getDate()).getTime()}if(e<t)return!0},e.getData=function(e){return this._data[e]},e.setData=function(e,t,i){this._data[e]?i?this._data[e]=t:console.log("已存在数据"):this._data[e]=t},e.clearData=function(){this._data={},this.init()},e.setStorage=function(e,t){let i=t||this.dataName;Laya.Browser.onMiniGame?wx.setStorage({key:i,data:e}):Laya.LocalStorage.setItem(i,JSON.stringify(e))},e.getStorage=function(e,t){let i,a=t||this.dataName;Laya.Browser.onMiniGame?wx.getStorage({key:a,success(t){e&&e(t.data)},fail(t){(i=Laya.LocalStorage.getItem(a))&&(i=JSON.parse(i)),e&&e(i)}}):((i=Laya.LocalStorage.getItem(a))&&(i=JSON.parse(i)),e&&e(i))},e.removeStorage=function(e,t){let i=t||this.dataName;Laya.Browser.onMiniGame?wx.removeStorage({key:i,success(t){e&&e(t.data)},fail(t){e&&e(-1)}}):Laya.LocalStorage.removeItem(i)},e.clearStorage=function(e){Laya.Browser.onMiniGame?wx.clearStorage({success(t){e&&e(t.data)},fail(t){e&&e(-1)}}):Laya.LocalStorage.clear()},e.getPlayerData=function(e){return m.getIns()[e]},e.setPlayerData=function(e,t){null!=this.getPlayerData(e)&&null!=this.getPlayerData(e)&&(m.getIns()[e]=t,m.getIns().save(),console.log("更新数据",e,t))},e.upLevel=function(){let e=this.getPlayerData("level")+1,t=this.getPlayerData("roundNum")+1;this.setPlayerData("roundNum",t),e>G.MAXLEVEL&&this.setPlayerData("tongGuan",!0),this.getPlayerData("tongGuan")?this.setPlayerData("level",utils.random(1,G.MAXLEVEL)):this.setPlayerData("level",e)},e.addYaoJi=function(e){for(var t=this.getPlayerData("ownMedicament").split(","),i=0;i<t.length;i++)if(t[i]==e)return;t.push(e),this.setPlayerData("ownMedicament",t.join(","))},e.queryYaoJi=function(e){for(var t=this.getPlayerData("ownMedicament").split(","),i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},e.getRewardID=function(){for(var e=Object.keys(D.AnimalParts),t=0;t<e.length;t++)if(!this.queryYaoJi(e[t]))return e[t];return!1},e.getNoOwn=function(){let e=Object.values(D.AnimalParts),t=[];for(let i=0;i<e.length;i++)this.queryYaoJi(e[i].id)||t.push(e[i].id);return t}}(),function(e){ulee.UpdateManager=function(){this.id=0,this.totalTime=0,this.LoopArr={},Laya.timer.frameLoop(1,this,this.update)},(0,Laya.ClassUtils.regClass)(ulee.UpdateManager,"ulee.UpdateManager",void 0);var t=ulee.UpdateManager.prototype;t.update=function(e){var t=Laya.timer.delta/1e3;for(var i in this.totalTime+=t,G.FPSAVERAGE=parseInt(1/t),G.FRAME_INTERVAL=t>.03?.03:t,G.NOW=Laya.Browser.now(),this.LoopArr){var a=this.LoopArr[i];a.caller?a.type==G.ENUM_LOOP_TYPE.FRAME?(a.frame++,a.frame==a.targetFrame&&(a.func(),a.isOnce?delete this.LoopArr[i]:a.frame=0)):a.type==G.ENUM_LOOP_TYPE.TIME&&(a.time+=t,a.time>=a.targetTime&&(a.func(),a.isOnce?delete this.LoopArr[i]:a.time=0)):console.log("warning:有方法没被移除"+a.func)}},t.frameLoop=function(e,t,i,a){var s=this.id++,o="FL"+s,n={frame:0,targetFrame:e,func:i.bind(t,a),args:a,caller:t,type:G.ENUM_LOOP_TYPE.FRAME,id:s};return this.LoopArr[o]=n,t.$updateArr?t.$updateArr.push(o):t.$updateArr=[o],o},t.frameOnce=function(e,t,i,a){var s=this.id++,o="FO"+s,n={frame:0,targetFrame:e,func:i.bind(t,a),args:a,isOnce:!0,caller:t,type:G.ENUM_LOOP_TYPE.FRAME,id:s};return t.$updateArr?t.$updateArr.push(o):t.$updateArr=[o],this.LoopArr[o]=n,o},t.timeLoop=function(e,t,i,a){var s=this.id++,o="TL"+s,n={time:0,targetTime:e,func:i.bind(t,a),args:a,caller:t,type:G.ENUM_LOOP_TYPE.TIME,id:s};return t.$updateArr?t.$updateArr.push(o):t.$updateArr=[o],this.LoopArr[o]=n,o},t.timeOnce=function(e,t,i,a){var s=this.id++,o="TO"+s,n={time:0,targetTime:e,func:i.bind(t,a),args:a,isOnce:!0,caller:t,type:G.ENUM_LOOP_TYPE.TIME,id:s};return t.$updateArr?t.$updateArr.push(o):t.$updateArr=[o],this.LoopArr[o]=n,o},t.clear=function(e,t){this.LoopArr[e]&&delete this.LoopArr[e],t&&G.remove(t.$updateArr,e)},t.clearAll=function(e){if(e.$updateArr){for(var t=0;t<e.$updateArr.length;t++){var i=e.$updateArr[t];this.clear(i)}e.$updateArr=null}}}(),function(){ulee.AudioManager=function(){this.soundManager=Laya.SoundManager,this.soundManager.autoReleaseSound=!1,this.isBGM||(this.hasChangeMusic=!0),this.setSoundVolume(.3),this.curSounds={}},(0,Laya.ClassUtils.regClass)(ulee.AudioManager,"ulee.AudioManager");var e=ulee.AudioManager.prototype;e.playMusic=function(e){e&&(this.bgmId!=e?(this.bgmId=e,this.hasChangeMusic=!0):this.hasChangeMusic=!1,dataManager.getPlayerData("isSound")&&G.ISSOUND&&(this.bgmId=e||this.bgmId,this.soundManager.playMusic(this.getResurl(this.bgmId),0),this.isPlaying=!0))},e.stopMusic=function(){this.soundManager.stopMusic(),this.isPlaying=!1},e.huifuMusicMuted=function(){dataManager.getPlayerData("isSound")&&this.setMusicMuted(!0)},e.setMusicMuted=function(e){this.soundManager.musicMuted=!e,this.hasChangeMusic&&(this.playMusic(this.bgmId),this.hasChangeMusic=!1)},e.setMusicVolume=function(e){this.soundManager.musicVolume=e},e.playSound=function(e,t,i){if(dataManager.getPlayerData("isSound")&&G.ISSOUND){if(this.curSounds[e]){if(!i&&this.curSounds[e].length>0)return}else this.curSounds[e]=[];var a=this.soundManager.playSound(this.getResurl(e),1,new Handler(this,function(){G.removeAt(this.curSounds[e],this.curSounds[e].indexOf(e)),t&&t()}));this.curSounds[e].push(a)}},e.stopSound=function(e){if(this.curSounds[e]&&this.curSounds[e].length>0)for(var t=0;t<this.curSounds[e].length;t++)this.soundManager.stopSound(this.getResurl(e)),G.removeAt(this.curSounds[e],t)},e.setSoundVolume=function(e){this.soundManager.soundVolume=e},e.stopAllSound=function(){this.soundManager.stopAllSound()},e.getResurl=function(e){return D.musicBasic[e].file}}();class A extends Laya.Script3D{constructor(){super(),this._tempVector3=new Laya.Vector3,this.yawPitchRoll=new Laya.Vector3,this.resultRotation=new Laya.Quaternion,this.tempRotationZ=new Laya.Quaternion,this.tempRotationX=new Laya.Quaternion,this.tempRotationY=new Laya.Quaternion,this.rotaionSpeed=6e-5}onAwake(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.mouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUp),this.camera=this.owner}_onDestroy(){Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.mouseDown),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.mouseUp)}onUpdate(e){var t=Laya.timer.delta;if(!isNaN(this.lastMouseX)&&!isNaN(this.lastMouseY)&&this.isMouseDown){this.owner.scene;Laya.KeyBoardManager.hasKeyDown(87)&&this.moveForward(-.01*t),Laya.KeyBoardManager.hasKeyDown(83)&&this.moveForward(.01*t),Laya.KeyBoardManager.hasKeyDown(65)&&this.moveRight(-.01*t),Laya.KeyBoardManager.hasKeyDown(68)&&this.moveRight(.01*t),Laya.KeyBoardManager.hasKeyDown(81)&&this.moveVertical(.01*t),Laya.KeyBoardManager.hasKeyDown(69)&&this.moveVertical(-.01*t);var i=Laya.stage.mouseX-this.lastMouseX,a=Laya.stage.mouseY-this.lastMouseY,s=this.yawPitchRoll;s.x-=i*this.rotaionSpeed*t,s.y-=a*this.rotaionSpeed*t,this.updateRotation()}this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY}mouseDown(e){this.camera.transform.localRotation.getYawPitchRoll(this.yawPitchRoll),this.lastMouseX=Laya.stage.mouseX,this.lastMouseY=Laya.stage.mouseY,this.isMouseDown=!0}mouseUp(e){this.isMouseDown=!1}moveForward(e){this._tempVector3.x=0,this._tempVector3.y=0,this._tempVector3.z=e,this.camera.transform.translate(this._tempVector3)}moveRight(e){this._tempVector3.y=0,this._tempVector3.z=0,this._tempVector3.x=e,this.camera.transform.translate(this._tempVector3)}moveVertical(e){this._tempVector3.x=this._tempVector3.z=0,this._tempVector3.y=e,this.camera.transform.translate(this._tempVector3,!1)}updateRotation(){Math.abs(this.yawPitchRoll.y)<1.5&&(Laya.Quaternion.createFromYawPitchRoll(this.yawPitchRoll.x,this.yawPitchRoll.y,this.yawPitchRoll.z,this.tempRotationZ),this.tempRotationZ.cloneTo(this.camera.transform.localRotation),this.camera.transform.localRotation=this.camera.transform.localRotation)}}!function(){ulee.CameraUtils=function(){this.upPos=new Laya.Vector3(0,1,0)},(0,Laya.ClassUtils.regClass)("ulee.CameraUtils",ulee.CameraUtils);var e=ulee.CameraUtils.prototype;e.createCamera=function(e,t,i){let a=new Laya.Camera(0,.1,1e3);return e&&a.transform.translate(e),t&&a.transform.rotate(t,!0,!1),i||(a.clearFlag=Laya.BaseCamera.CLEARFLAG_DEPTHONLY),a},e.controlCamera=function(e){e.addComponent(A)},e.setTarget=function(e,t){this.camera=t,this.m_Target=e,this.baseY=this.m_Target.transform.position.y,this.angleA=-10,this.angleB=0,this.r=15},e.FollowTarget=function(e){if(null!=this.m_Target){this.m_MoveSpeed=5;var t=new Laya.Vector3;Laya.Vector3.lerp(this.camera.transform.position,this.m_Target.transform.position,e*this.m_MoveSpeed,t),t.y+=1.3,t.z+=2.29,this.camera.transform.position=t}},e.LookAtTarget=function(){this.camera.transform.lookAt(this.m_Target.transform.position,this.upPos)},e.HandleRotateMovement=function(e){this.angleA-=e.x/10,this.angleB+=e.y/10;var t=this.camera.transform.position;t.x=this.r*Math.sin(this.angleB*Math.RAD_1_ANGLE)*Math.sin(this.angleA*Math.RAD_1_ANGLE)+this.m_Target.transform.position.x,t.y=this.r*Math.cos(this.angleB*Math.RAD_1_ANGLE)+this.m_Target.transform.position.y,t.z=this.r*Math.sin(this.angleB*Math.RAD_1_ANGLE)*Math.cos(this.angleA*Math.RAD_1_ANGLE)+this.m_Target.transform.position.z,this.camera.transform.position=t,this.camera.transform.lookAt(this.m_Target.transform.position,this.upPos)}}(),window.cameraUtils=new ulee.CameraUtils;window.tools=class{static copyForm(e,t){for(let i in t)e[i]=t[i]}static copyForm2(e,t){for(let i in t)"string"!=typeof t[i]&&"number"!=typeof t[i]&&"boolean"!=typeof t[i]||(e[i]=t[i])}static isEqualDateTime(e,t){if(!e||!t||0==e||0==t)return!1;let i=new Date(e),a=new Date(t);return i.getFullYear()==a.getFullYear()&&i.getMonth()==a.getMonth()&&i.getDate()==a.getDate()}static getAngleByTwoPoint(e,t){let i=t.x-e.x,a=t.y-e.y;return 180*Math.atan2(a,i)/Math.PI}static norTime(e){let t=Math.floor(e/3600),i=e%60;return t+":"+t%60+":"+(i>9?""+i:"0"+i)}static norSecondTime(e){let t=e%60;return Math.floor(e/60)+":"+(t>9?""+t:"0"+t)}static get3D22Dpos(e,t){let i=new Laya.Vector3;return t.viewport.project(e,t.projectionViewMatrix,i),i}static in3DPosInScene(e,t){let i=this.get3D22Dpos(e,t);return i.x>=0&&i.x<=Laya.stage.width&&i.y>=0&&i.y<=Laya.stage.height}static pointInRect(e,t,i){let a=(i.b.x-i.a.x)*(t-i.a.y)-(i.b.y-i.a.y)*(e-i.a.x),s=(i.c.x-i.b.x)*(t-i.b.y)-(i.c.y-i.b.y)*(e-i.b.x),o=(i.d.x-i.c.x)*(t-i.c.y)-(i.d.y-i.c.y)*(e-i.c.x),n=(i.a.x-i.d.x)*(t-i.d.y)-(i.a.y-i.d.y)*(e-i.d.x);return a>0&&s>0&&o>0&&n>0||a<0&&s<0&&o<0&&n<0}static getLineMethodParam(e,t,i,a){let s=0;return i!=e&&(s=(a-t)/(i-e)),{k:s,b:a-s*i}}static getPointDistLine(e,t,i,a){return Math.abs(i*e-t+a)/Math.sqrt(i*i+1)}static getTwoPointDist(e,t,i,a){return Math.sqrt((i-e)*(i-e)+(a-t)*(a-t))}static isIn(e,t,i){return e>=t&&e<=i}static getBerizPoint(e,t,i,a){return[Math.pow(1-e,2)*t.x+2*e*(1-e)*i.x+Math.pow(e,2)*a.x,Math.pow(1-e,2)*t.y+2*e*(1-e)*i.y+Math.pow(e,2)*a.y]}static getStrColorToRbg(e){let t=[];for(let i=1;i<e.length;i+=2)255==parseInt("0x"+e.slice(i,i+2))?t.push(255):t.push(parseInt("0x"+e.slice(i,i+2))/255);return t}static flyImg(e,t,i=6,a,s,o,n,l){let r,h=t||Laya.stage;for(let t=0;t<i;t++)(r=new Laya.Image(e)).x=a,r.y=s,h.addChild(r),Laya.Tween.to(r,{x:o,y:n},500,null,new Laya.Handler(this,function(e,a){e.removeSelf(),e=null,t==i-1&&l()},[r,t]),60*t)}static imgComarse(e,t,i,a,s){if(!t)return 0;let o=new Laya.Image;o.loadImage(e),o.drawToCanvas(i,a,0,0),Laya.Browser.onQGMiniGame;let n=o.drawToCanvas(i,a,0,0);Laya.SubmitCanvas;let l=t.drawToCanvas(i,a,0,0);s(this.pixelsContrast(n.getTexture().getPixels(0,0,500,375),l.getTexture().getPixels(0,0,i,a),i,a))}static pixelsContrast(e,t,i,a){var s=i||8,o=a||8;e=this.pixelsToBinary(e,1),t=this.pixelsToBinary(t,1);var n=0,l=0,r=0;let h=s*o/2;for(var d=0;d<h;d++)1!=e[d]&&0!=e[d]&&console.log(e[d]),0==e[d]&&0==t[d]||(0==e[d]&&1==t[d]?r++:1==e[d]&&(l++,1==t[d]&&n++));var c=(n-r)/l*100;return c<0&&(c=0),(c=Math.floor(c))>97&&(c=100),c}static pixelsToBinary(e,t){var i=0,a=e.length,s=0,o=new Uint8Array(a/8);if(!t){for(var n=0;n<a;n+=8)i+=.299*e[n]+.587*e[n+1]+.114*e[n+2];t=i/=a/4}let l=0;for(n=0;n<a;n+=8).299*e[n]+.587*e[n+1]+.114*e[n+2]>=t?(o[s++]=1,l++):o[s++]=0;return console.log("tcount:"+l),o}static getSpPixels(e,t,i){let a=new Laya.Image;return a.loadImage(e),a.drawToCanvas(tmplw,tmplh,0,0).getTexture().getPixels(0,0,t,i)}static createColorFilter(e=0,t=0,i=0){let a=[e,0,0,0,0,0,t,0,0,0,0,0,i,0,0,0,0,0,1,0];return[new Laya.ColorFilter(a)]}static twMoveList(e){let t=e;t.scrollTo(0),t.tweenTo(9,2e4)}static stopMove(e){let t=e;Laya.Tween.clearTween(t)}static random(e,t){return Math.floor(Math.random()*(t+1-e)+e)}static arrayRandom(e){return e[this.random(0,e.length-1)]}static shiftRandom(e){var t=this.random(0,e.length-1),i=e[t];return G.removeAt(e,t),i}static randomIndexByWeight(e,t){if(!t){t=0;for(var i=0;i<e.length;i++)t+=e[i]}for(var a=this.random(0,t+1),s=0;s<e.length;s++)if((a-=e[s])<=0)return s;return 0}},Laya.Sprite.drawToCanvas=function(e,t,i,a,s,o){s-=e.x,o-=e.y,s|=0,o|=0,i|=0,a|=0;var n=new Context;n.size(i,a),n.asBitmap=!0,n._targets.start(),n._targets.clear(0,0,0,0),RenderSprite.renders[t]._fun(e,n,s,o),n.flush(),n._targets.end(),n._targets.restore();var l=n._targets.getData(0,0,i,a);n.destroy();var r=new HTMLCanvas(!0);r.size(i,a);for(var h=r.getContext("2d").getImageData(0,0,i,a),d=4*i,c=h.data,u=a-1,m=u*d,g=0;u>=0;u--)c.set(l.subarray(g,g+d),m),m-=d,g+=d;var p=new HTMLCanvas(!0);return p.size(i,a),p.getContext("2d").putImageData(h,0,0),p};new class{constructor(){window.Laya3D?Laya3D.init(S.width,S.height):Laya.init(S.width,S.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=S.scaleMode,Laya.stage.screenMode=S.screenMode,Laya.stage.alignV=S.alignV,Laya.stage.alignH=S.alignH,Laya.stage.bgColor="#06b7ef",Laya.URL.exportSceneToJson=S.exportSceneToJson,(S.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),S.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),S.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.stage._setScreenSize=Laya.stage.setScreenSize,Laya.stage.setScreenSize=function(e,t,i){if(!Laya.stage._isInputting()){var a=function(){if(G.SCREEN_MODE==G.SCREEN_MODETYPE.H){var e={},t=Laya.Browser.clientWidth*Laya.Browser.pixelRatio,i=Laya.Browser.clientHeight*Laya.Browser.pixelRatio,a=1559/854,s=1559/720,o=n=Laya.Browser.onPC?i/t:i>t?i/t:t/i;n>1559/720?(e.scaleMode=Laya.Stage.SCALE_FIXED_AUTO,e.height=720,e.width=1559,G.ratio=Laya.Browser.clientWidth/Laya.stage.width):n<1559/720?(e.scaleMode=Laya.Stage.SCALE_FIXED_AUTO,e.height=854,e.width=1559,G.ratio=Laya.Browser.clientHeight/Laya.stage.height):(e.scaleMode=Laya.Stage.SCALE_FIXED_HEIGHT,e.height=720,e.width=1559,G.ratio=Laya.Browser.clientWidth/Laya.stage.width),e.trueRate=o}else{var n;e={},t=Laya.Browser.clientWidth*Laya.Browser.pixelRatio,i=Laya.Browser.clientHeight*Laya.Browser.pixelRatio,a=1559/854,s=1559/720,o=n=Laya.Browser.onPC?i/t:i>t?i/t:t/i,n>s?(e.scaleMode=Laya.Stage.SCALE_FIXED_AUTO,e.height=1559,e.width=720,G.ratio=Laya.Browser.clientWidth/Laya.stage.width):n<a?(e.scaleMode=Laya.Stage.SCALE_FIXED_AUTO,e.height=1559,e.width=854,G.ratio=Laya.Browser.clientHeight/Laya.stage.height):(e.scaleMode=Laya.Stage.SCALE_FIXED_HEIGHT,e.height=1559,e.width=854,G.ratio=Laya.Browser.clientWidth/Laya.stage.width),e.trueRate=o}return e}();this._scaleMode=a.scaleMode,this.designHeight=a.height,this.designWidth=a.width,this._setScreenSize(e,t),i||Laya.timer.once(2e3,null,function(){Laya.stage.setScreenSize(Laya.Browser.clientWidth*Laya.Browser.pixelRatio,Laya.Browser.clientHeight*Laya.Browser.pixelRatio,!0)})}},Laya.stage._changeCanvasSize(),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){window.updateManager=new ulee.UpdateManager,window.uiManager=new ulee.UIManager,window.audioManager=new ulee.AudioManager,eventDispatcher.addEventListen(ulee.Event.ON_DATA_LOAD,this,function(){window.dataManager=new ulee.DataManager,dataManager.initData(),this.onConfigLoaded_sdk_fb()}),initData()}onConfigLoaded_sdk_fb(){if("undefined"!=typeof minigame){let e=this;minigame.initializeAsync().then(function(){console.log("FB initializeAsync"),minigame.getEntryPointAsync().then(function(e){console.info("Entry Point: ",e)});const t=minigame.context.getType();console.info("Context Type: ",t),e.startMiniGameSDK()})}}startMiniGameSDK(){"undefined"!=typeof minigame&&(minigame.setLoadingProgress(100),minigame.startGameAsync().then(function(){S.startScene&&uiManager.openUI(S.startScene)}).catch(function(e){console.info("startGameAsync error: "+e)}))}}}();